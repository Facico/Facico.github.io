<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="决策树类型 ID3 C4.5 CART(回归树) 优缺点优点：计算复杂度不高，输出易于理解，对缺失值不敏感，可以处理不相关特征数据">
<meta property="og:type" content="article">
<meta property="og:title" content="决策树">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;11&#x2F;08&#x2F;%E5%86%B3%E7%AD%96%E6%A0%91&#x2F;index.html">
<meta property="og:site_name" content="Facico的博客">
<meta property="og:description" content="决策树类型 ID3 C4.5 CART(回归树) 优缺点优点：计算复杂度不高，输出易于理解，对缺失值不敏感，可以处理不相关特征数据">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;img2018.cnblogs.com&#x2F;blog&#x2F;1507784&#x2F;201907&#x2F;1507784-20190719103004647-1767677624.png">
<meta property="og:updated_time" content="2020-03-06T07:17:38.665Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;img2018.cnblogs.com&#x2F;blog&#x2F;1507784&#x2F;201907&#x2F;1507784-20190719103004647-1767677624.png">

<link rel="canonical" href="http://yoursite.com/2019/11/08/%E5%86%B3%E7%AD%96%E6%A0%91/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>决策树 | Facico的博客</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Facico的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>主页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/08/%E5%86%B3%E7%AD%96%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/psu.jpg">
      <meta itemprop="name" content="Facico">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Facico的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          决策树
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-08 17:34:33" itemprop="dateCreated datePublished" datetime="2019-11-08T17:34:33+08:00">2019-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-06 15:17:38" itemprop="dateModified" datetime="2020-03-06T15:17:38+08:00">2020-03-06</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><ul>
<li>ID3</li>
<li>C4.5</li>
<li>CART(回归树)</li>
</ul><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优点：计算复杂度不高，输出易于理解，对缺失值不敏感，可以处理不相关特征数据</p><a id="more"></a>

<p>缺点：可能会产生过度匹配问题，过拟合</p>
<p>使用数据类型：数值型和布尔型</p>
<h2 id="香农熵-信息熵"><a href="#香农熵-信息熵" class="headerlink" title="香农熵(信息熵)"></a>香农熵(信息熵)</h2><p>熵定义为信息的期望值，表示信息的无序程度</p>
<p>变量的不确定性越大，熵也就越大，把它搞清楚所需要的信息量也越大<br>$$<br>l(x_i)=-log_2{p(xi)}<br>$$</p>
<p>$$<br>H=-\sum_{i=1}^np(x_i)log_2p(x_i)<br>$$</p>
<p>l(x)表示信息x的定义，p(x)表示x的出现概率，$p(x_i)log_2p(x_i)$是信息$x_i$的熵(信息量的期望)，H是总信息的熵</p>
<h3 id="经验熵"><a href="#经验熵" class="headerlink" title="经验熵"></a>经验熵</h3><ul>
<li><p>举个例子：我们要区分什么是鱼</p>
<p>有很多数据：不浮出水可以生存，有脚蹼，是鱼；不浮出水可以生存，无脚蹼，不是鱼….等等</p>
<p>不浮出水是否生存和有无脚蹼就是判断依据，是不是鱼就是目标信息(bool型)</p>
</li>
</ul>
<p>经验熵就是对目标信息计算香农熵</p>
<h3 id="条件熵"><a href="#条件熵" class="headerlink" title="条件熵"></a>条件熵</h3><p>$$<br>H(Y|X)=\sum_{i=1}^np_iH(Y|X=x_i)   //p_i=P(X=x_i)<br>$$</p>
<p>H(Y|X)：X给定条件下Y的熵，如上X有n个分类，pi表示第i个分类在数据中的比例，H(Y|X=xi)表示第i个分类的数据在一起时的熵。</p>
<p>举个例子：现在数据被拆分成两个部分1和2，数据的比例分别为为p1,p2，数据的熵分别为h1,h2。那么按这个拆分的条件熵就是$p1<em>h1+p2</em>h2$ </p>
<h4 id="信息增益"><a href="#信息增益" class="headerlink" title="信息增益"></a>信息增益</h4><p>$$<br>g(D,A)=H(D)-H(D|A)<br>$$</p>
<p>目的是是g(D,A)最大，就是让熵减小的更多，就是在分类(拆分)后，熵的和最小</p>
<p><strong>注意，这里的H都是经验熵</strong></p>
<h4 id="信息增益比-信息增益率"><a href="#信息增益比-信息增益率" class="headerlink" title="信息增益比(信息增益率)"></a>信息增益比(信息增益率)</h4><p>$$<br>split_{infoA}(S)=-\sum_{j=1}^v{|S_j|\over |S|}log_2{({|S_j|\over |S|})}<br>$$</p>
<p>split定义为分裂信息，上面求的就是S按照特征A的分类的熵， $S_i(1≤i≤v)$是样本即S在特征A上的划分，在v种不同的划分。<strong>可以发现这个也是熵，不过划分条件就不像是目标信息那样了，而是按照</strong>特征A的分类来算熵</p>
<p>信息增益率就是<br>$$<br>Gain_{Ratio(A)}={Gain(A)\over {split_{infoA}(S)}}<br>$$<br>Gain(A)就是g(D,A)，还是按A的分类来的经验熵</p>
<p>信息增益率简单来说就是$目标信息划分后的熵(经验熵)\over 特征A的自己的熵$</p>
<h4 id="信息增益与信息增益率区分"><a href="#信息增益与信息增益率区分" class="headerlink" title="信息增益与信息增益率区分"></a>信息增益与信息增益率区分</h4><p><img src="https://img2018.cnblogs.com/blog/1507784/201907/1507784-20190719103004647-1767677624.png" alt="img"></p>
<p>信息增益就相当于当前以分类A为基准，把其他的拆开，所能减少的熵，只是单向考虑熵(如果我每个都分成一类，熵肯定是最小的，所以没有考虑树枝的情况)</p>
<p>信息增益率：考虑了树枝的情况，就是把树枝的分支也算进了熵的计算里面，避免了分支太多的情况</p>
<p>如上H(A)就是信息增益率中考虑树的枝条的情况，作为分母可以理解成<strong>均摊到每个枝条的熵</strong></p>
<h2 id="基尼不纯度"><a href="#基尼不纯度" class="headerlink" title="基尼不纯度"></a>基尼不纯度</h2><ul>
<li>定义：将来自集合中的某种结果随机应用于集合中某一数据项的预期误差率</li>
</ul>
<p>$$<br>I_G(f)=\sum_{i=1}^nf_i(1-f_i)=\sum_{i=1}^n(f_i-f_i^2)={\sum_{i=1}^nfi}-\sum_{i=1}^nfi_i^2=1-\sum_{i=1}^nf_i^2<br>$$</p>
<p>也能描述信息的无序程度，用于CART的分类</p>
<h2 id="平方误差"><a href="#平方误差" class="headerlink" title="平方误差"></a>平方误差</h2><p>$$<br>\sum_{x_i\in R_m}(y_i-f(x_i))^2<br>$$</p>
<p>yi表示正确结果，f(xi)表示学习之后的结果，一般f用Rm集合中的均值表示</p>
<h2 id="算法框架"><a href="#算法框架" class="headerlink" title="算法框架"></a>算法框架</h2><h3 id="决策树主函数"><a href="#决策树主函数" class="headerlink" title="决策树主函数"></a>决策树主函数</h3><p>主函数是一个递归函数，主要功能是按照某种规则生长出决策树的各个分支节点，并根据终止条件结束算法</p>
<p>递归边界：</p>
<ul>
<li>1、当前同一个叶子节点的所有数据的目标类型相同，就算有还有多个分类标记也无所谓</li>
<li>2、当前只剩下一个分类标记，此时返回出现评率最大的目标分类</li>
</ul>
<p>如果信息增益(信息增益率，基尼不纯度增益……)小于阈值，则选择最大的目标分类</p>
<h3 id="计算最优特征子函数"><a href="#计算最优特征子函数" class="headerlink" title="计算最优特征子函数"></a>计算最优特征子函数</h3><p>3中决策树采用了三种不同的策略：</p>
<ul>
<li>1、ID3算法计算信息增益</li>
<li>2、C4.5算法计算信息增益率</li>
<li>3、CART分类时算法计算基尼不纯度，回归时计算最小剩余平方误差</li>
</ul>
<h3 id="分类器"><a href="#分类器" class="headerlink" title="分类器"></a>分类器</h3><p>通过遍历整棵决策树，使测试集数据找到决策树中叶子节点对应的类别标签,最后将测试数据定义为叶子节点所属的类型</p>
<p>流程：根据分类标记不断的往下走，走到叶子节点，返回次叶子节点的标记</p>
<h2 id="区分"><a href="#区分" class="headerlink" title="区分"></a>区分</h2><ul>
<li><p>ID3：信息增益 = 划分前熵 - 划分后熵。信息增益越大，则意味着使用属性 a 来进行划分所获得的 “纯度提升” 越大 。也就是说，用属性 a 来划分训练集，得到的结果中纯度比较高。</p>
</li>
<li><p>C4.5：C4.5 克服了 ID3 仅仅能够处理离散属性的问题，以及信息增益偏向<strong>选择取值较多特征的问题</strong>(<strong>如果取属性取值比较多，则划分完之后信息增益会很大，就是搞了个n叉的树枝出来</strong>)，使用信息增益比来选择特征。信息增益比 = 信息增益 / 划分前熵  选择信息增益比最大的作为最优特征。</p>
<p>C4.5和ID3都是单变量决策树(<strong>就是全程只用一个变量来划分比例计算熵</strong>)</p>
</li>
<li><p>CART用基尼不纯度，搞出来的一定是二叉树</p>
</li>
</ul>
<p>这些都是网上的诉说</p>
<p><strong>然而，我自己打的时候</strong></p>
<p>这三棵树都能是多叉树，都能处理连续值和离散值，都能多分类，只要遇到连续值就二分类就能解决，虽然不是很好，不过也可以把连续值划分区间然后来做离散值</p>
<h2 id="C4-5对连续属性的处理"><a href="#C4-5对连续属性的处理" class="headerlink" title="C4.5对连续属性的处理"></a>C4.5对连续属性的处理</h2><ul>
<li>1、对特征取值排序</li>
<li>2、两个特征取值之间额中点作为可能的分裂点，将数据集分成两部分，计算每个可能的分裂点的信息增益</li>
<li>3、选择修正后信息增益最大的分裂点作为该特征的最佳分裂点</li>
<li>4、计算最佳分裂点的信息增益率<strong>。注意</strong>，此处需对最佳分裂点的信息增益进行修正：<strong>减去log2(N-1)/|D|（N是连续特征的取值个数</strong>，D是训练数据数目，此修正的原因在于：当离散属性和连续属性并存时，C4.5算法倾向于选择连续特征做最佳树分裂点）</li>
</ul>
<p>连续属性的取值就很多，所以不用ID3</p>
<h2 id="树回归"><a href="#树回归" class="headerlink" title="树回归"></a>树回归</h2><p>当数据拥有许多特征并且特征之间的关系十分复杂时，构建全局模型的想法就显得太难了，而且生活中很多问题都是非线性的，不可能用全局线性模型来拟合任何数据。</p>
<p>所以我们可以考虑将数据集切分成很多份易建模的数据，然后利用线性回归来建模。如果切完之后还难以拟合，就继续切分。</p>
<h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li>优点：可以对复杂和非线性的数据建模</li>
<li>缺点：结果不易理解</li>
<li>使用数据类型：数据性和标准型数据</li>
</ul>
<p>回归树的叶子节点是连续性而不是离散型。</p>
<h3 id="树回归的一般流程"><a href="#树回归的一般流程" class="headerlink" title="树回归的一般流程"></a>树回归的一般流程</h3><ul>
<li>收集数据：采用任意方法收集数据</li>
<li>准备数据：需要数值型数据，标准型数据应该映射成二值型数据</li>
<li>分析数据：绘出数据的二维可视化显示结果，以字典方式生成树</li>
<li>训练算法：大部分时间都花费在叶节点树模型的构建上</li>
<li>测试算法：使用测试数据上的R2值来分析模型的效果</li>
<li>使用算法：使用训练出的树做预测，预测结果还可以用来做很多事情</li>
</ul>
<h2 id="树剪枝"><a href="#树剪枝" class="headerlink" title="树剪枝"></a>树剪枝</h2><p>剪枝根据我的理解可以分为：针对树的形态上的剪枝和针对正确率的剪枝(树的形态的剪枝往往很能影响正确率，因为会提高泛化能力—-&gt;一般的后剪枝都能提高正确率)</p>
<h3 id="预剪枝"><a href="#预剪枝" class="headerlink" title="预剪枝"></a>预剪枝</h3><p>预剪枝就是在生成节点的时候，如果信息增益小于阈值或节点个数当前已经很少，那么就把当前的点作为叶子节点</p>
<p>递归边界也是预剪枝</p>
<p>还有一种预剪枝是在生成树的时候，每次切分后，判断一下正确率，如果降低了就不切分。然后后面有一种错误率降低剪枝要比这个好</p>
<h3 id="后剪枝"><a href="#后剪枝" class="headerlink" title="后剪枝"></a>后剪枝</h3><h4 id="错误率降低剪枝-REP"><a href="#错误率降低剪枝-REP" class="headerlink" title="错误率降低剪枝(REP)"></a>错误率降低剪枝(REP)</h4><ul>
<li>建完树</li>
<li>递归从下到上(实现的时候用逆向DFS序)，判断减掉之后正确率会不会提高，若提高就剪掉</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#错误率降低剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">REPrunning</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(tsize[<span class="number">0</span>],<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> (son[i] == <span class="number">1</span>): <span class="keyword">continue</span></span><br><span class="line">            pre = self.access()</span><br><span class="line">            az[i] = <span class="number">1</span></span><br><span class="line">            now = self.access()</span><br><span class="line">            <span class="keyword">if</span>(now &gt; pre):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>: az[i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br></pre></td></tr></table></figure>

<p>az表示是否删掉，若删掉就不走，这个是最好打的后剪枝</p>
<h4 id="悲观剪枝-PEP"><a href="#悲观剪枝-PEP" class="headerlink" title="悲观剪枝(PEP)"></a>悲观剪枝(PEP)</h4><h5 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h5><ul>
<li>二项分布的正态逼近</li>
</ul>
<p>听起来很高级，但是实际的思想很简单，就是把二项分布弄的正态分布一样，有$\mu和\delta$</p>
<p>然后用$[\mu-\delta,\mu+\delta]$作为置信区间(也可以自己变一变，可以区间的一边不封闭)</p>
<ul>
<li>对于一个子树来说</li>
</ul>
<p>$$<br>p=\frac{err+alpha*son}{sum}       //err是错误分类个数，alpha是自定义参数，son是叶子个数，sum是节点总数<br>$$</p>
<p>$$<br>均值 mean=p*sum<br>$$</p>
<p>$$<br>因为是二项分布 方差val=\sqrt{sum<em>p</em>(1-p)}<br>$$</p>
<p>引进alpha的目的就是调节概率模型，使其逼近正态分布。而且可以量化叶子节点的代价</p>
<ul>
<li>步骤(从上到下，从下到上好像正确率要低一点)<ul>
<li>算出当前子树的meanpre和valpre</li>
<li>算出把当前节点当做叶节点的meannow和valnow</li>
<li>如果meannow在置信区间内就能减，因为减了影响不是很大</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcDU</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">        val = tree[<span class="string">'val'</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">            tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">    pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">    ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">    meannow = tree[<span class="string">'sum'</span>]*pnow</span><br><span class="line">    meanpre = tree[<span class="string">'sum'</span>]*ppre</span><br><span class="line">    valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">    valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">    <span class="keyword">if</span> (meanpre + valpre &gt; meannow)<span class="keyword">and</span>(meanpre - valpre &lt; meannow):</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                <span class="keyword">del</span> tree[i]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">        <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">        tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcUD</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">    ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">    meannow = tree[<span class="string">'sum'</span>] * pnow</span><br><span class="line">    meanpre = tree[<span class="string">'sum'</span>] * ppre</span><br><span class="line">    valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">    valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">    <span class="keyword">if</span> (meanpre + valpre &gt; meannow)<span class="keyword">and</span>(meanpre - valpre &lt; meannow):</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                <span class="keyword">del</span> tree[i]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">        <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">        tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">        val = tree[<span class="string">'val'</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">            tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PEPrunning</span><span class="params">(self, alpha = <span class="number">0.1</span>)</span>:</span></span><br><span class="line">    self.tree = self.PEPrunningCalcUD(self.tree, alpha)</span><br><span class="line">    <span class="keyword">return</span> self.access()</span><br></pre></td></tr></table></figure>



<h4 id="代价复杂度剪枝-改版"><a href="#代价复杂度剪枝-改版" class="headerlink" title="代价复杂度剪枝(改版)"></a>代价复杂度剪枝(改版)</h4><p>$$<br>f(x)=sum*Ent + alpha//对于每个叶子节点，sum是叶子中的数据总数，Ent是叶子节点的熵(基尼…..)<br>$$</p>
<p>然后目标是是$\sum f(x)最小$</p>
<p>那么就动态规划</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#代价复杂度后剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningCalc</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            f[x][<span class="number">0</span>] = tree[<span class="string">'sum'</span>]*tree[<span class="string">'Ent'</span>] + alpha</span><br><span class="line">            f[x][<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            f[x][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                self.costPrunningCalc(tree[i], alpha)</span><br><span class="line">                o = f[son][<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> (f[son][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[son][<span class="number">1</span>])</span><br><span class="line">                f[x][<span class="number">0</span>] += o</span><br><span class="line">            f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        f[x][<span class="number">0</span>] = f[le][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[le][<span class="number">1</span>] != <span class="literal">None</span>): f[x][<span class="number">0</span>] = min(f[x][<span class="number">0</span>], f[le][<span class="number">1</span>])</span><br><span class="line">        o = f[ri][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[ri][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[ri][<span class="number">1</span>])</span><br><span class="line">        f[x][<span class="number">0</span>] += o</span><br><span class="line">        f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningDel</span><span class="params">(self, tree, bz)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = f[x][bz]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        <span class="keyword">if</span> (bz == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            lenx = len(val)</span><br><span class="line">            <span class="keyword">for</span> bin <span class="keyword">in</span> range(<span class="number">1</span>&lt;&lt;lenx):</span><br><span class="line">                tot = <span class="number">-1</span></span><br><span class="line">                o = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    tot += <span class="number">1</span></span><br><span class="line">                    l = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                    son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                    <span class="keyword">if</span> (f[son][l] == <span class="literal">None</span>):</span><br><span class="line">                        tot = <span class="number">-2</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    o += f[son][l]</span><br><span class="line">                <span class="keyword">if</span> (o != f[x][bz]): tot = <span class="number">-2</span></span><br><span class="line">                <span class="keyword">if</span> (tot != <span class="number">-2</span>):</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                        tot += <span class="number">0</span></span><br><span class="line">                        l = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                        self.costPrunningCalc(tree[i], l)</span><br><span class="line">                    <span class="keyword">return</span> tree</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        yi = er =<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> (f[le][i] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> (f[ri][j] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> (f[le][i] + f[ri][j] == f[x][bz]):</span><br><span class="line">                    yi, er = i, j</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'left'</span>], yi)</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'right'</span>], er)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunning</span><span class="params">(self, alpha = <span class="number">10</span>)</span>:</span></span><br><span class="line">        self.costPrunningCalc(self.tree, alpha)</span><br><span class="line">        bz = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (f[<span class="number">1</span>][<span class="number">0</span>] &gt; f[<span class="number">1</span>][<span class="number">1</span>]): bz = <span class="number">1</span></span><br><span class="line">        tsize = [<span class="number">0</span>]</span><br><span class="line">        self.tree = self.costPrunningDel(self.tree, bz)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br></pre></td></tr></table></figure>

<h2 id="随机森林"><a href="#随机森林" class="headerlink" title="随机森林"></a>随机森林</h2><p>顾名思义：有很多棵决策树，还是建立在随机之上</p>
<h3 id="随机的东西"><a href="#随机的东西" class="headerlink" title="随机的东西"></a>随机的东西</h3><ul>
<li>数据集：用自助法采数据集</li>
<li>每个树要用到的feature：每棵树只用k个feature，这个随机，k建议去log2(特征总数)</li>
</ul>
<p>然后对于每个测试样本，投票或均值</p>
<p>随机森林正确率真的很高！！！</p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><p>用graphviz</p>
<h2 id="Python-熬测时候的裁员数据集"><a href="#Python-熬测时候的裁员数据集" class="headerlink" title="Python(熬测时候的裁员数据集)"></a>Python(熬测时候的裁员数据集)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"><span class="comment">#决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecisionTree</span>:</span></span><br><span class="line">    dataSet = []; testSet = []; dataO = []</span><br><span class="line">    labelSet = []; testLabel = []; key = &#123;&#125;</span><br><span class="line">    strkey = []; valkey = []</span><br><span class="line">    replaceTo = &#123;&#125;; replaceBack = &#123;&#125;</span><br><span class="line">    algor = <span class="string">'None'</span></span><br><span class="line">    Thresh = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line">    tree = &#123;&#125;</span><br><span class="line">    <span class="comment"># 下载数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        fr = read_csv(filename)</span><br><span class="line">        fr.replace(<span class="string">'?'</span>, nan, inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> fr</span><br><span class="line">    <span class="comment"># 删掉缺失值多的key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delColumn</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        dataIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        delVal = n//<span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> dataIndex:</span><br><span class="line">            <span class="keyword">if</span> (dataSet[inx].isnull().sum() &gt;= delVal):</span><br><span class="line">                dataSet = dataSet.drop(inx, axis=<span class="number">1</span>)</span><br><span class="line">        dataSet.drop(<span class="string">'EmployeeNumber'</span>, axis=<span class="number">1</span>)</span><br><span class="line">        dataSet.drop(<span class="string">'EmployeeCount'</span>, axis=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 寻找异常值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">boxDiagram</span><span class="params">(self, dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        throw = set([])</span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> nIndex:</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (tot <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Attrition'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            <span class="comment"># 排出缺失值</span></span><br><span class="line">            data = data[data.notnull()]</span><br><span class="line">            <span class="comment"># 箱型图</span></span><br><span class="line">            Q1, Q3 = percentile(data, <span class="number">25</span>), percentile(data, <span class="number">75</span>)</span><br><span class="line">            IQR = Q3 - Q1</span><br><span class="line">            throw = throw | set(data[data &gt; Q3 + <span class="number">3</span> * IQR].keys())</span><br><span class="line">            throw = throw | set(data[data &lt; Q1 - <span class="number">3</span> * IQR].keys())</span><br><span class="line">            <span class="comment"># 温和异常值判为缺失值</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &gt; Q3 + <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &lt; Q1 - <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> throw:</span><br><span class="line">            dataSet = dataSet.drop(i, axis=<span class="number">0</span>)</span><br><span class="line">        dataSet.dropna(axis=<span class="number">0</span>, how=<span class="string">"all"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        dataSet = dataSet.reindex(range(dataSet.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 计算距离</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OjiDist</span><span class="params">(self,dataSet, x, y, m)</span>:</span></span><br><span class="line">        z = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">if</span> (str(dataSet.iloc[x, i]) == <span class="string">'nan'</span>) <span class="keyword">or</span> (str(dataSet.iloc[y, i]) == <span class="string">'nan'</span>): <span class="keyword">continue</span>;</span><br><span class="line">            z += (dataSet.iloc[x, i] - dataSet.iloc[y, i]) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> sqrt(z)</span><br><span class="line">    <span class="comment"># 处理缺失值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solveMissing</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="string">"""for i in range(n):</span></span><br><span class="line"><span class="string">            if (dataSet.iloc[i].isnull().sum() == 0): continue</span></span><br><span class="line"><span class="string">            mini = 0</span></span><br><span class="line"><span class="string">            distMin = inf</span></span><br><span class="line"><span class="string">            for j in range(n):</span></span><br><span class="line"><span class="string">                if (i == j): continue</span></span><br><span class="line"><span class="string">                if (dataSet.iloc[j].isnull().sum() &gt; 0): continue</span></span><br><span class="line"><span class="string">                distx = self.OjiDist(dataSet, i, j, m)</span></span><br><span class="line"><span class="string">                if (distx &lt; distMin):</span></span><br><span class="line"><span class="string">                    distMin = distx</span></span><br><span class="line"><span class="string">                    mini = j</span></span><br><span class="line"><span class="string">            for j in range(m):</span></span><br><span class="line"><span class="string">                if (str(dataSet.iloc[i, j]) == 'nan'): dataSet.iloc[i, j] = dataSet.iloc[mini, j]"""</span></span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nIndex:</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            data = dataSet[i]</span><br><span class="line">            <span class="keyword">if</span> (i==<span class="string">'Attrition'</span>): meanx = median(data[data.notnull()])</span><br><span class="line">            <span class="keyword">elif</span> (tot <span class="keyword">in</span> self.strkey): meanx = dataSet[i].mode()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>: meanx = mean(data[data.notnull()])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> (str(dataSet.loc[j, i]) == <span class="string">'nan'</span>):</span><br><span class="line">                    dataSet.loc[j, i] = meanx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 记录离散值和连续值的key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitStrVal</span><span class="params">(self)</span>:</span></span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Attrition'</span>): <span class="keyword">continue</span></span><br><span class="line">            x = self.dataO.loc[<span class="number">1</span>, inx]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (isinstance(x, str)):</span><br><span class="line">                self.valkey.append(tot)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.strkey.append(tot)</span><br><span class="line">    <span class="comment"># 将离散值标号</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceStr</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> nIndex:</span><br><span class="line">            x = self.dataO.loc[<span class="number">1</span>, inx]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (isinstance(x, str)): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                y = dataSet.loc[j, inx]</span><br><span class="line">                <span class="keyword">if</span> (y <span class="keyword">not</span> <span class="keyword">in</span> self.replaceTo):</span><br><span class="line">                    tot+=<span class="number">1</span></span><br><span class="line">                    self.replaceTo[y] = tot</span><br><span class="line">                    self.replaceBack[tot] = y</span><br><span class="line">                self.dataO.loc[j, inx] = self.replaceTo[y]</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 特征标准化处理</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">standardize</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        keyN = dataSet.keys()</span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> keyN:</span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Outcome'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            meanx = data.mean()</span><br><span class="line">            stdx = data.std()</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                dataSet.loc[j, inx] = (dataSet.loc[j, inx] - meanx) / stdx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 预处理模块</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PreProcess</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.dataO = self.delColumn(self.dataO)</span><br><span class="line">        self.dataO[<span class="string">'Attrition'</span>].replace(<span class="string">'Yes'</span>, <span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        self.dataO[<span class="string">'Attrition'</span>].replace(<span class="string">'No'</span>, <span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        self.splitStrVal()</span><br><span class="line">        self.dataO = self.boxDiagram(self.dataO)</span><br><span class="line">        self.dataO = self.solveMissing(self.dataO)</span><br><span class="line">        <span class="comment">#self.dataO = self.standardize(self.dataO)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据划分留出法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dataSplit</span><span class="params">(self,P = <span class="number">0.8</span>)</span>:</span></span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        S = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO[<span class="string">'Attrition'</span>]:</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1.0</span>): S += <span class="number">1</span></span><br><span class="line">        N = n - S; S = P * S</span><br><span class="line">        N = P * N; SS = NN = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="comment">#p = random.random()</span></span><br><span class="line">            p = <span class="number">0.1</span>*(i%<span class="number">10</span>)</span><br><span class="line">            data = list(self.dataO.iloc[i])</span><br><span class="line">            <span class="keyword">if</span> (p &lt;= P):</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">1</span>] == <span class="number">1.0</span>) <span class="keyword">and</span> (SS &gt;= S): p = <span class="number">1.0</span> - p</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">1</span>] == <span class="number">0.0</span>) <span class="keyword">and</span> (NN &gt;= N): p = <span class="number">1.0</span> - p</span><br><span class="line">            <span class="keyword">if</span> (p &lt;= P):</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">1</span>] == <span class="number">1.0</span>): SS += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>: NN += <span class="number">1</span></span><br><span class="line">                dataSet.append(data[:<span class="number">1</span>]+data[<span class="number">2</span>:]), labelSet.append(data[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                testSet.append(data[:<span class="number">1</span>]+data[<span class="number">2</span>:]), testLabel.append(data[<span class="number">1</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 自助法划分</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BSsplit</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        dataIndex = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            x = random.randint(<span class="number">0</span>, n - <span class="number">1</span>)</span><br><span class="line">            dataIndex.append(x)</span><br><span class="line">        setIndex = set(dataIndex)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            data = list(self.dataO.iloc[dataIndex[i]])</span><br><span class="line">            dataSet.append(data[:<span class="number">1</span>]+data[<span class="number">2</span>:]), labelSet.append(data[<span class="number">1</span>])</span><br><span class="line">            data = self.dataO.iloc[i]</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">not</span> <span class="keyword">in</span> setIndex): testSet.append(data[:<span class="number">1</span>]+data[<span class="number">2</span>:]), testLabel.append(data[<span class="number">1</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 随机k个特征</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keyRandom</span><span class="params">(self, p=<span class="number">0.7</span>)</span>:</span></span><br><span class="line">        m = self.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            keybz[i] = <span class="number">1</span></span><br><span class="line">        upx = m*p;</span><br><span class="line">        arr = arange(m)</span><br><span class="line">        random.shuffle(arr)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(round(upx)):</span><br><span class="line">            keybz[arr[i]] = <span class="number">0</span></span><br><span class="line">    <span class="comment">#香农熵</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcShannonEnt</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Ent = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key]/n)</span><br><span class="line">            Ent -= prob*log(prob,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> Ent</span><br><span class="line">    <span class="comment">#基尼不纯度</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcGink</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Gink = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key] / n)</span><br><span class="line">            Gink -= prob*prob</span><br><span class="line">        <span class="keyword">return</span> Gink</span><br><span class="line">    <span class="comment">#计算标准差*长度</span></span><br><span class="line">    <span class="comment"># 计算均值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcMean</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> mean(labelSet)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcSqrError</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        meanx = mean(labelSet)</span><br><span class="line">        Dvalue = labelSet - tile(meanx,(labelSet.shape[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">        Dvalue = Dvalue**<span class="number">2</span></span><br><span class="line">        sumx = sum(Dvalue)</span><br><span class="line">        <span class="keyword">return</span> sumx</span><br><span class="line">        <span class="comment">#return 1</span></span><br><span class="line"></span><br><span class="line">    calc = &#123;<span class="string">'ID3'</span>: calcShannonEnt, <span class="string">'C45'</span>: calcShannonEnt, <span class="string">'CARTC'</span>: calcGink</span><br><span class="line">            ,<span class="string">'CARTR'</span>: calcSqrError&#125;</span><br><span class="line">    <span class="comment">#统计label的各个值的数量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcClass</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">            lab = labelSet[i]</span><br><span class="line">            classX[lab] = classX.get(lab, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> classX</span><br><span class="line">    <span class="comment">#按照feat和val分离数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitToFeat</span><span class="params">(self, dataSet, labelSet, feat, val)</span>:</span></span><br><span class="line">        datA = dataSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        labA = labelSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        datB = dataSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        labB = labelSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> datA, labA, datB, labB</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitToSame</span><span class="params">(self, dataSet, labelSet, feat, val)</span>:</span></span><br><span class="line">        dat = dataSet[nonzero(dataSet[:, feat] == val)[<span class="number">0</span>]]</span><br><span class="line">        lab = labelSet[nonzero(dataSet[:, feat] == val)[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> dat, lab</span><br><span class="line">    <span class="comment">#计算叶子节点的标签</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcLeave</span><span class="params">(self, labelSet, algor)</span>:</span></span><br><span class="line">        treshVal = self.treshVal</span><br><span class="line">        <span class="comment"># 找label中的均值</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            o = self.calcMean(labelSet)</span><br><span class="line">            <span class="keyword">return</span> o</span><br><span class="line">        <span class="comment"># 找label中的最多的</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        sortX = sorted(classX.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> sortX[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#找当前分界点</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chooseBest</span><span class="params">(self, dataSet, labelSet, algor, Thresh)</span>:</span></span><br><span class="line">        n, m = shape(dataSet)</span><br><span class="line">        <span class="keyword">if</span> (sum(labelSet==labelSet[<span class="number">0</span>])==n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, labelSet[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (m == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        EntO = self.calc[algor](self,labelSet)</span><br><span class="line">        BEnt = inf; Bfeat = Bval = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">                a = dataSet[:, feat]</span><br><span class="line">                <span class="keyword">if</span> (max(a)==min(a)): <span class="keyword">continue</span></span><br><span class="line">                setX = list(sorted(set(a)))</span><br><span class="line">                val = mean(a)</span><br><span class="line">            <span class="comment">#for j in range(len(setX)-1):</span></span><br><span class="line">            <span class="comment">#for val in setX:</span></span><br><span class="line">                <span class="comment">#if(val==max(setX))or(val==min(setX)): continue</span></span><br><span class="line">                <span class="comment">#val = (setX[j] + setX[j+1]) / 2.0</span></span><br><span class="line">                datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, feat, val)</span><br><span class="line">                probA = float((datA.shape[<span class="number">0</span>])/n)</span><br><span class="line">                probB = float((datB.shape[<span class="number">0</span>])/n)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                    probA = probB = <span class="number">1.0</span></span><br><span class="line">                Ent = probA*self.calc[algor](self,labA) + probB*self.calc[algor](self,labB)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'C45'</span>):</span><br><span class="line">                    Ent = Ent/(self.calc[algor](self,a) + <span class="number">0.1</span>)</span><br><span class="line">                <span class="keyword">if</span> (Ent &lt; BEnt):</span><br><span class="line">                    BEnt, Bfeat, Bval = Ent, feat, val</span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">if</span> (feat <span class="keyword">not</span> <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">            a = dataSet[:, feat]</span><br><span class="line">            setX = list(sorted(set(a)))</span><br><span class="line">            Ent = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> setX:</span><br><span class="line">                dat, lab = self.splitToSame(dataSet, labelSet, feat, val)</span><br><span class="line">                numx = lab.shape[<span class="number">0</span>]</span><br><span class="line">                prob = numx*<span class="number">1.0</span>/n</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>): prob = <span class="number">1.0</span></span><br><span class="line">                Ent += prob*self.calc[algor](self, lab)</span><br><span class="line">            <span class="keyword">if</span> (algor == <span class="string">'C45'</span>):</span><br><span class="line">                Ent = Ent / (self.calc[algor](self, a) + <span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">if</span> (Ent &lt; BEnt):</span><br><span class="line">                BEnt, Bfeat = Ent, feat</span><br><span class="line">        <span class="keyword">if</span> (EntO-BEnt&lt;Thresh[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        <span class="keyword">if</span> (datA.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>])<span class="keyword">and</span>(datB.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        <span class="keyword">return</span> Bfeat, Bval</span><br><span class="line">    <span class="comment">#建树</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, dataSet, labelSet)</span>:</span></span><br><span class="line">        algor = self.algor</span><br><span class="line">        Thresh = self.Thresh</span><br><span class="line">        Bfeat, Bval = self.chooseBest(dataSet, labelSet, algor, Thresh)</span><br><span class="line">        <span class="keyword">if</span> (Bfeat == <span class="literal">None</span>):</span><br><span class="line">            tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">            son.append(<span class="number">1</span>)</span><br><span class="line">            tree = &#123;<span class="string">'val'</span>: Bval, <span class="string">'num'</span>: tsize[<span class="number">0</span>], <span class="string">'Ent'</span>: self.calc[algor](self, labelSet)</span><br><span class="line">                , <span class="string">'sum'</span>: dataSet.shape[<span class="number">0</span>], <span class="string">'mx'</span>: self.calcLeave(labelSet, algor),</span><br><span class="line">                    <span class="string">'err'</span>: sum(labelSet != self.calcLeave(labelSet, algor)) * <span class="number">1.0</span>,</span><br><span class="line">                    <span class="string">'son'</span>: <span class="number">1</span>, <span class="string">'errs'</span>: sum(labelSet != self.calcLeave(labelSet, algor)) * <span class="number">1.0</span>&#125;</span><br><span class="line">            <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                tree[<span class="string">'errs'</span>] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                    <span class="keyword">if</span> (fabs(labelSet[i] - tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'errs'</span>] += <span class="number">1</span></span><br><span class="line">                tree[<span class="string">'err'</span>] = tree[<span class="string">'errs'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        son.append(<span class="number">0</span>)</span><br><span class="line">        tree = &#123;&#125;</span><br><span class="line">        tree[<span class="string">'feat'</span>] = Bfeat</span><br><span class="line">        tree[<span class="string">'val'</span>] = Bval</span><br><span class="line">        tree[<span class="string">'num'</span>] = tsize[<span class="number">0</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = self.calc[algor](self, labelSet)</span><br><span class="line">        tree[<span class="string">'mx'</span>] = self.calcLeave(labelSet, algor)</span><br><span class="line">        tree[<span class="string">'err'</span>] = sum(labelSet != tree[<span class="string">'mx'</span>]) * <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            tree[<span class="string">'err'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                <span class="keyword">if</span> (fabs(labelSet[i] - tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'err'</span>] += <span class="number">1</span></span><br><span class="line">        tree[<span class="string">'sum'</span>] = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (Bfeat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            a = dataSet[:, Bfeat]</span><br><span class="line">            setX = list(sorted(set(a)))</span><br><span class="line">            Ent = <span class="number">0</span></span><br><span class="line">            tree[<span class="string">'val'</span>] = setX</span><br><span class="line">            tree[<span class="string">'son'</span>] = tree[<span class="string">'errs'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> setX:</span><br><span class="line">                dat, lab = self.splitToSame(dataSet, labelSet, Bfeat, val)</span><br><span class="line">                <span class="keyword">if</span> (lab.shape[<span class="number">0</span>] == <span class="number">0</span>):</span><br><span class="line">                    ans = <span class="number">1</span></span><br><span class="line">                tree[val] = self.buildTree(dat, lab)</span><br><span class="line">                tree[<span class="string">'son'</span>] += tree[val][<span class="string">'son'</span>]</span><br><span class="line">                tree[<span class="string">'errs'</span>] += tree[val][<span class="string">'errs'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.buildTree(datA, labA)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.buildTree(datB, labB)</span><br><span class="line">        tree[<span class="string">'son'</span>] = tree[<span class="string">'left'</span>][<span class="string">'son'</span>] + tree[<span class="string">'right'</span>][<span class="string">'son'</span>]</span><br><span class="line">        tree[<span class="string">'errs'</span>] = tree[<span class="string">'left'</span>][<span class="string">'errs'</span>] + tree[<span class="string">'right'</span>][<span class="string">'errs'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="comment">#对测试集分类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">classifyTest</span><span class="params">(self, tree, test)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (az[x]==<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'val'</span>]</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        val = tree[<span class="string">'val'</span>]</span><br><span class="line">        <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                <span class="keyword">if</span> (i == test[feat]):</span><br><span class="line">                    <span class="keyword">return</span> self.classifyTest(tree[i], test)</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">if</span> (test[feat] &lt; val): <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'left'</span>], test)</span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'right'</span>], test)</span><br><span class="line">    <span class="comment">#评估</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">access</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        err = <span class="number">0</span>;yi=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = self.classifyTest(self.tree, self.testSet[i])</span><br><span class="line">            <span class="keyword">if</span> (self.algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                <span class="keyword">if</span> (fabs(lab - self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (lab != self.testLabel[i]): err += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (n-err)*<span class="number">1.0</span>/n</span><br><span class="line">    <span class="comment"># 评估forest</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accessForest</span><span class="params">(self, forest)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        m = len(forest)</span><br><span class="line">        err = <span class="number">0</span>;</span><br><span class="line">        yi = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                lab += self.classifyTest(forest[j],self.testSet[i])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (self.algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                <span class="keyword">if</span> (fabs(lab/m - self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (lab &gt; m - lab): lab = <span class="number">1.0</span></span><br><span class="line">                <span class="keyword">else</span>: lab = <span class="number">0.0</span></span><br><span class="line">                <span class="keyword">if</span> (lab != self.testLabel[i]): err += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (n - err) * <span class="number">1.0</span> / n</span><br><span class="line">    <span class="comment">#代价复杂度后剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningCalc</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            f[x][<span class="number">0</span>] = tree[<span class="string">'sum'</span>]*tree[<span class="string">'Ent'</span>] + alpha</span><br><span class="line">            f[x][<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            f[x][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                self.costPrunningCalc(tree[i], alpha)</span><br><span class="line">                o = f[son][<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> (f[son][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[son][<span class="number">1</span>])</span><br><span class="line">                f[x][<span class="number">0</span>] += o</span><br><span class="line">            f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        f[x][<span class="number">0</span>] = f[le][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[le][<span class="number">1</span>] != <span class="literal">None</span>): f[x][<span class="number">0</span>] = min(f[x][<span class="number">0</span>], f[le][<span class="number">1</span>])</span><br><span class="line">        o = f[ri][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[ri][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[ri][<span class="number">1</span>])</span><br><span class="line">        f[x][<span class="number">0</span>] += o</span><br><span class="line">        f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningDel</span><span class="params">(self, tree, bz)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = f[x][bz]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        <span class="keyword">if</span> (bz == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            lenx = len(val)</span><br><span class="line">            <span class="keyword">for</span> bin <span class="keyword">in</span> range(<span class="number">1</span>&lt;&lt;lenx):</span><br><span class="line">                tot = <span class="number">-1</span></span><br><span class="line">                o = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    tot += <span class="number">1</span></span><br><span class="line">                    l = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                    son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                    <span class="keyword">if</span> (f[son][l] == <span class="literal">None</span>):</span><br><span class="line">                        tot = <span class="number">-2</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    o += f[son][l]</span><br><span class="line">                <span class="keyword">if</span> (o != f[x][bz]): tot = <span class="number">-2</span></span><br><span class="line">                <span class="keyword">if</span> (tot != <span class="number">-2</span>):</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                        tot += <span class="number">0</span></span><br><span class="line">                        l = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                        self.costPrunningCalc(tree[i], l)</span><br><span class="line">                    <span class="keyword">return</span> tree</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        yi = er =<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> (f[le][i] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> (f[ri][j] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> (f[le][i] + f[ri][j] == f[x][bz]):</span><br><span class="line">                    yi, er = i, j</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'left'</span>], yi)</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'right'</span>], er)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunning</span><span class="params">(self, alpha = <span class="number">10</span>)</span>:</span></span><br><span class="line">        self.costPrunningCalc(self.tree, alpha)</span><br><span class="line">        bz = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (f[<span class="number">1</span>][<span class="number">0</span>] &gt; f[<span class="number">1</span>][<span class="number">1</span>]): bz = <span class="number">1</span></span><br><span class="line">        tsize = [<span class="number">0</span>]</span><br><span class="line">        self.tree = self.costPrunningDel(self.tree, bz)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#错误率降低剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">REPrunning</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(tsize[<span class="number">0</span>],<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> (son[i] == <span class="number">1</span>): <span class="keyword">continue</span></span><br><span class="line">            pre = self.access()</span><br><span class="line">            az[i] = <span class="number">1</span></span><br><span class="line">            now = self.access()</span><br><span class="line">            <span class="keyword">if</span>(now &gt; pre):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>: az[i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#悲观剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcDU</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">            tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>]*pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>]*ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span> (meanpre + valpre &gt; meannow)<span class="keyword">and</span>(meanpre - valpre &lt; meannow):</span><br><span class="line">            <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcUD</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>] * pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>] * ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span> (meanpre + valpre &gt; meannow)<span class="keyword">and</span>(meanpre - valpre &lt; meannow):</span><br><span class="line">            <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">            tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunning</span><span class="params">(self, alpha = <span class="number">0.1</span>)</span>:</span></span><br><span class="line">        self.tree = self.PEPrunningCalcUD(self.tree, alpha)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#决策树可视化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treePaint</span><span class="params">(self, tree, dotx)</span>:</span></span><br><span class="line">        keyx = self.key</span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            dotx.node(name=str(x), label=str(tree[<span class="string">'val'</span>]), color=<span class="string">'green'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                self.treePaint(tree[i], dotx)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.treePaint(tree[<span class="string">'left'</span>], dotx)</span><br><span class="line">            self.treePaint(tree[<span class="string">'right'</span>], dotx)</span><br><span class="line">        dotx.node(name=str(x), label=<span class="string">'split to '</span>+str(keyx[tree[<span class="string">'feat'</span>]]), color=<span class="string">'red'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                dotx.edge(str(x), str(son), label=<span class="string">'is '</span> + str(self.replaceBack[i]), color=<span class="string">'black'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">            dotx.edge(str(x), str(le), label=<span class="string">'&lt;'</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">            dotx.edge(str(x), str(ri), label=<span class="string">'&gt;='</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treeVisualize</span><span class="params">(self, nameadd)</span>:</span></span><br><span class="line">        dotx = Digraph(name=<span class="string">'Decision'</span>+<span class="string">'('</span>+nameadd+<span class="string">')'</span>, format=<span class="string">"png"</span>)</span><br><span class="line">        self.treePaint(self.tree, dotx)</span><br><span class="line">        dotx.node(name=<span class="string">'a'</span>, label=<span class="string">'acc: '</span>+str(DCTree.access())+<span class="string">'\n'</span>, color=<span class="string">'blue'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        dotx.view()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ID3决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ID3</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'ID3'</span></span><br><span class="line">    Thresh = (<span class="number">0.0001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#C45决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C45</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'C45'</span></span><br><span class="line">    Thresh = (<span class="number">0.01</span>, <span class="number">10</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#CART决策树,带入参数,C是分类,R是回归</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CART</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (attr == <span class="string">'C'</span>): self.algor = <span class="string">'CARTC'</span></span><br><span class="line">        <span class="keyword">else</span>: self.algor = <span class="string">'CARTR'</span></span><br><span class="line">    Thresh = (<span class="number">0.001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment"># 随机森林</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomForest</span><span class="params">(num, filename)</span>:</span></span><br><span class="line">    forest = []</span><br><span class="line">    treex = CART(<span class="string">'C'</span>)</span><br><span class="line">    treex.dataO = treex.loadDataSet(filename)</span><br><span class="line">    treex.splitStrVal()</span><br><span class="line">    treex.dataO = treex.replaceStr(treex.dataO)</span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        tsize[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        son[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        treex.BSsplit()</span><br><span class="line">        pp = log(treex.dataSet.shape[<span class="number">1</span>], <span class="number">2</span>)/treex.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        treex.keyRandom(p=pp)</span><br><span class="line">        treex.tree=treex.buildTree(treex.dataSet, treex.labelSet)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(tsize[<span class="number">0</span>]+<span class="number">1</span>):</span><br><span class="line">            f[j][<span class="number">0</span>] = f[j][<span class="number">1</span>] = az[j] = <span class="number">0</span></span><br><span class="line">        treex.PEPrunning()</span><br><span class="line">        forest.append(treex.tree)</span><br><span class="line">    treex.dataSplit()</span><br><span class="line">    <span class="keyword">return</span> treex.accessForest(forest)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tsize = [<span class="number">0</span>]</span><br><span class="line">    son = [<span class="number">0</span>]</span><br><span class="line">    DCTree = CART(<span class="string">'R'</span>)</span><br><span class="line">    <span class="comment">#DCTree.dataO = DCTree.loadDataSet('diabetesN.csv')</span></span><br><span class="line">    DCTree.dataO = DCTree.loadDataSet(<span class="string">'employeeFiredN.csv'</span>)</span><br><span class="line">    f = [[<span class="number">0</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># costPrunning</span></span><br><span class="line">    az = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># REPrunning</span></span><br><span class="line">    keybz = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># randomForest</span></span><br><span class="line">    <span class="comment">#DCTree.PreProcess()</span></span><br><span class="line">    <span class="comment">#DCTree.dataO.to_csv('employeeFiredN.csv', index=False)</span></span><br><span class="line">    DCTree.splitStrVal()</span><br><span class="line">    DCTree.dataO = DCTree.replaceStr(DCTree.dataO)</span><br><span class="line">    DCTree.dataSplit()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(DCTree.strkey)): DCTree.strkey[i] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(DCTree.valkey)): DCTree.valkey[i] -= <span class="number">1</span></span><br><span class="line">    DCTree.tree=DCTree.buildTree(DCTree.dataSet, DCTree.labelSet)</span><br><span class="line">    print(DCTree.access())</span><br><span class="line">    print(DCTree.PEPrunning())</span><br><span class="line">    <span class="comment">#DCTree.treeVisualize('PEP')</span></span><br><span class="line">    print(randomForest(<span class="number">20</span>,<span class="string">'employeeFiredN.csv'</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Python糖尿病数据集"><a href="#Python糖尿病数据集" class="headerlink" title="Python糖尿病数据集"></a>Python糖尿病数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecisionTree</span>:</span></span><br><span class="line">    dataSet = []; testSet = []; dataO = []</span><br><span class="line">    labelSet = []; testLabel = []; key = &#123;&#125;</span><br><span class="line">    algor = <span class="string">'None'</span></span><br><span class="line">    Thresh = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line">    tree = &#123;&#125;</span><br><span class="line">    <span class="comment"># 下载数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        fr = read_csv(filename)</span><br><span class="line">        <span class="keyword">return</span> fr</span><br><span class="line">    <span class="comment"># 删掉缺失值多的key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delColumn</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        dataIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        delVal = n//<span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> dataIndex:</span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Outcome'</span>) <span class="keyword">or</span> (inx == <span class="string">'Pregnancies'</span>): <span class="keyword">continue</span></span><br><span class="line">            dataSet[inx].replace(<span class="number">0</span>,nan,inplace=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">if</span> (dataSet[inx].isnull().sum() &gt;= delVal):</span><br><span class="line">                dataSet = dataSet.drop(inx, axis=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 寻找异常值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">boxDiagram</span><span class="params">(self, dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        throw = set([])</span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> nIndex:</span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Outcome'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            <span class="comment"># 排出缺失值</span></span><br><span class="line">            data = data[data.notnull()]</span><br><span class="line">            <span class="comment"># 箱型图</span></span><br><span class="line">            Q1, Q3 = percentile(data, <span class="number">25</span>), percentile(data, <span class="number">75</span>)</span><br><span class="line">            IQR = Q3 - Q1</span><br><span class="line">            throw = throw | set(data[data &gt; Q3 + <span class="number">3</span> * IQR].keys())</span><br><span class="line">            throw = throw | set(data[data &lt; Q1 - <span class="number">3</span> * IQR].keys())</span><br><span class="line">            <span class="comment"># 温和异常值判为缺失值</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &gt; Q3 + <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &lt; Q1 - <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> throw:</span><br><span class="line">            dataSet = dataSet.drop(i, axis=<span class="number">0</span>)</span><br><span class="line">        dataSet.dropna(axis=<span class="number">0</span>, how=<span class="string">"all"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        dataSet = dataSet.reindex(range(dataSet.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 计算距离</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OjiDist</span><span class="params">(self,dataSet, x, y, m)</span>:</span></span><br><span class="line">        z = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">if</span> (str(dataSet.iloc[x, i]) == <span class="string">'nan'</span>) <span class="keyword">or</span> (str(dataSet.iloc[y, i]) == <span class="string">'nan'</span>): <span class="keyword">continue</span>;</span><br><span class="line">            z += (dataSet.iloc[x, i] - dataSet.iloc[y, i]) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> sqrt(z)</span><br><span class="line">    <span class="comment"># 处理缺失值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solveMissing</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="string">"""for i in range(n):</span></span><br><span class="line"><span class="string">            if (dataSet.iloc[i].isnull().sum() == 0): continue</span></span><br><span class="line"><span class="string">            mini = 0</span></span><br><span class="line"><span class="string">            distMin = inf</span></span><br><span class="line"><span class="string">            for j in range(n):</span></span><br><span class="line"><span class="string">                if (i == j): continue</span></span><br><span class="line"><span class="string">                if (dataSet.iloc[j].isnull().sum() &gt; 0): continue</span></span><br><span class="line"><span class="string">                distx = self.OjiDist(dataSet, i, j, m)</span></span><br><span class="line"><span class="string">                if (distx &lt; distMin):</span></span><br><span class="line"><span class="string">                    distMin = distx</span></span><br><span class="line"><span class="string">                    mini = j</span></span><br><span class="line"><span class="string">            for j in range(m):</span></span><br><span class="line"><span class="string">                if (str(dataSet.iloc[i, j]) == 'nan'): dataSet.iloc[i, j] = dataSet.iloc[mini, j]"""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nIndex:</span><br><span class="line">            data = dataSet[i]</span><br><span class="line">            <span class="keyword">if</span>(i == <span class="string">'Outcome'</span>): meanx = median(data[data.notnull()])</span><br><span class="line">            <span class="keyword">else</span>: meanx = mean(data[data.notnull()])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> (str(dataSet.loc[j, i]) == <span class="string">'nan'</span>):</span><br><span class="line">                    dataSet.loc[j, i] = meanx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 特征标准化处理</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">standardize</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        keyN = dataSet.keys()</span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> keyN:</span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Outcome'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            meanx = data.mean()</span><br><span class="line">            stdx = data.std()</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                dataSet.loc[j, inx] = (dataSet.loc[j, inx] - meanx) / stdx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 预处理模块</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PreProcess</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.dataO = self.delColumn(self.dataO)</span><br><span class="line">        self.dataO = self.boxDiagram(self.dataO)</span><br><span class="line">        self.dataO = self.solveMissing(self.dataO)</span><br><span class="line">        <span class="comment">#self.dataO = self.standardize(self.dataO)</span></span><br><span class="line">    <span class="comment"># 数据划分留出法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dataSplit</span><span class="params">(self,P = <span class="number">0.7</span>)</span>:</span></span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        S = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO[<span class="string">'Outcome'</span>]:</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1.0</span>): S += <span class="number">1</span></span><br><span class="line">        N = n - S; S = P * S</span><br><span class="line">        N = P * N; SS = NN = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            p = random.random()</span><br><span class="line">            <span class="comment">#p = 0.1*(i%10)</span></span><br><span class="line">            data = self.dataO.iloc[i]</span><br><span class="line">            <span class="keyword">if</span> (p &lt;= P):</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">7</span>] == <span class="number">1.0</span>) <span class="keyword">and</span> (SS &gt;= S): p = <span class="number">1.0</span> - p</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">7</span>] == <span class="number">0.0</span>) <span class="keyword">and</span> (NN &gt;= N): p = <span class="number">1.0</span> - p</span><br><span class="line">            <span class="keyword">if</span> (p &lt;= P):</span><br><span class="line">                <span class="keyword">if</span> (data[<span class="number">7</span>] == <span class="number">1.0</span>): SS += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>: NN += <span class="number">1</span></span><br><span class="line">                dataSet.append(data[:<span class="number">7</span>]), labelSet.append(data[<span class="number">7</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                testSet.append(data[:<span class="number">7</span>]), testLabel.append(data[<span class="number">7</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 自助法划分</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BSsplit</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        dataIndex = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            x = random.randint(<span class="number">0</span>, n - <span class="number">1</span>)</span><br><span class="line">            dataIndex.append(x)</span><br><span class="line">        setIndex = set(dataIndex)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            data = self.dataO.iloc[dataIndex[i]]</span><br><span class="line">            dataSet.append(data[:<span class="number">7</span>]), labelSet.append(data[<span class="number">7</span>])</span><br><span class="line">            data = self.dataO.iloc[i]</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">not</span> <span class="keyword">in</span> setIndex): testSet.append(data[:<span class="number">7</span>]), testLabel.append(data[<span class="number">7</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 随机k个特征</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keyRandom</span><span class="params">(self, p=<span class="number">0.7</span>)</span>:</span></span><br><span class="line">        m = self.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            keybz[i] = <span class="number">1</span></span><br><span class="line">        upx = m*p;</span><br><span class="line">        arr = arange(m)</span><br><span class="line">        random.shuffle(arr)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(round(upx)):</span><br><span class="line">            keybz[arr[i]] = <span class="number">0</span></span><br><span class="line">    <span class="comment">#香农熵</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcShannonEnt</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Ent = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key]/n)</span><br><span class="line">            Ent -= prob*log(prob,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> Ent</span><br><span class="line">    <span class="comment">#基尼不纯度</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcGink</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Gink = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key] / n)</span><br><span class="line">            Gink -= prob*prob</span><br><span class="line">        <span class="keyword">return</span> Gink</span><br><span class="line">    <span class="comment">#计算标准差*长度</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcSqrError</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        meanx = mean(labelSet)</span><br><span class="line">        Dvalue = labelSet - tile(meanx, (labelSet.shape[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">        Dvalue = Dvalue ** <span class="number">2</span></span><br><span class="line">        sumx = sum(Dvalue)</span><br><span class="line">        <span class="keyword">return</span> sumx</span><br><span class="line">        <span class="comment">#return 1</span></span><br><span class="line">    <span class="comment">#计算均值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcMean</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> mean(labelSet)</span><br><span class="line">    calc = &#123;<span class="string">'ID3'</span>: calcShannonEnt, <span class="string">'C45'</span>: calcShannonEnt, <span class="string">'CARTC'</span>: calcGink</span><br><span class="line">            ,<span class="string">'CARTR'</span>: calcSqrError&#125;</span><br><span class="line">    <span class="comment">#统计label的各个值的数量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcClass</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">            lab = labelSet[i]</span><br><span class="line">            classX[lab] = classX.get(lab, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> classX</span><br><span class="line">    <span class="comment">#按照feat和val分离数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitToFeat</span><span class="params">(self, dataSet, labelSet, feat, val)</span>:</span></span><br><span class="line">        datA = dataSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        labA = labelSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        datB = dataSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        labB = labelSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> datA, labA, datB, labB</span><br><span class="line">    <span class="comment">#计算叶子节点的标签</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcLeave</span><span class="params">(self, labelSet, algor)</span>:</span></span><br><span class="line">        treshVal = self.treshVal</span><br><span class="line">        <span class="comment"># 找label中的均值</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            o = self.calcMean(labelSet)</span><br><span class="line">            <span class="keyword">return</span> o</span><br><span class="line">        <span class="comment"># 找label中的最多的</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        sortX = sorted(classX.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> sortX[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#找当前分界点</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chooseBest</span><span class="params">(self, dataSet, labelSet, algor, Thresh)</span>:</span></span><br><span class="line">        n, m = shape(dataSet)</span><br><span class="line">        <span class="keyword">if</span> (sum(labelSet==labelSet[<span class="number">0</span>])==n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, labelSet[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (m == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        EntO = self.calc[algor](self,labelSet)</span><br><span class="line">        BEnt = inf; Bfeat = Bval = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> (keybz[feat] == <span class="number">1</span>): <span class="keyword">continue</span></span><br><span class="line">                a = dataSet[:, feat]</span><br><span class="line">                <span class="keyword">if</span> (max(a)==min(a)): <span class="keyword">continue</span></span><br><span class="line">                setX = list(sorted(set(a)))</span><br><span class="line">                val = mean(a)</span><br><span class="line">            <span class="comment">#for j in range(len(setX)-1):</span></span><br><span class="line">            <span class="comment">#for val in setX:</span></span><br><span class="line">                <span class="comment">#if(val==max(setX))or(val==min(setX)): continue</span></span><br><span class="line">                <span class="comment">#val = (setX[j] + setX[j+1]) / 2.0</span></span><br><span class="line">                datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, feat, val)</span><br><span class="line">                probA = float((datA.shape[<span class="number">0</span>])/n)</span><br><span class="line">                probB = float((datB.shape[<span class="number">0</span>])/n)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                    probA = probB = <span class="number">1.0</span></span><br><span class="line">                Ent = probA*self.calc[algor](self,labA) + probB*self.calc[algor](self,labB)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'C45'</span>):</span><br><span class="line">                    Ent = Ent / (self.calc[algor](self,a) + <span class="number">0.1</span>)</span><br><span class="line">                <span class="keyword">if</span> (Ent &lt; BEnt):</span><br><span class="line">                    BEnt, Bfeat, Bval = Ent, feat, val</span><br><span class="line">        <span class="keyword">if</span> (EntO-BEnt&lt;Thresh[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        <span class="keyword">if</span> (datA.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>])<span class="keyword">and</span>(datB.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        <span class="keyword">return</span> Bfeat, Bval</span><br><span class="line">    <span class="comment">#建树</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, dataSet, labelSet)</span>:</span></span><br><span class="line">        algor = self.algor</span><br><span class="line">        Thresh = self.Thresh</span><br><span class="line">        Bfeat ,Bval= self.chooseBest(dataSet, labelSet, algor, Thresh)</span><br><span class="line">        <span class="keyword">if</span> (Bfeat == <span class="literal">None</span>):</span><br><span class="line">            tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">            son.append(<span class="number">1</span>)</span><br><span class="line">            tree = &#123;<span class="string">'val'</span>: Bval, <span class="string">'num'</span>: tsize[<span class="number">0</span>], <span class="string">'Ent'</span>: self.calc[algor](self, labelSet)</span><br><span class="line">                , <span class="string">'sum'</span>: dataSet.shape[<span class="number">0</span>], <span class="string">'mx'</span>: self.calcLeave(labelSet, algor),</span><br><span class="line">                    <span class="string">'err'</span>: sum(labelSet != self.calcLeave(labelSet, algor)) * <span class="number">1.0</span>,</span><br><span class="line">                    <span class="string">'son'</span>: <span class="number">1</span>, <span class="string">'errs'</span>: sum(labelSet != self.calcLeave(labelSet, algor)) * <span class="number">1.0</span>&#125;</span><br><span class="line">            <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                tree[<span class="string">'errs'</span>] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                    <span class="keyword">if</span> (fabs(labelSet[i] - tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'errs'</span>] += <span class="number">1</span></span><br><span class="line">                tree[<span class="string">'err'</span>] = tree[<span class="string">'errs'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        son.append(<span class="number">0</span>)</span><br><span class="line">        tree = &#123;&#125;</span><br><span class="line">        tree[<span class="string">'feat'</span>] = Bfeat</span><br><span class="line">        tree[<span class="string">'val'</span>] = Bval</span><br><span class="line">        tree[<span class="string">'num'</span>] = tsize[<span class="number">0</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = self.calc[algor](self, labelSet)</span><br><span class="line">        tree[<span class="string">'mx'</span>] = self.calcLeave(labelSet, algor)</span><br><span class="line">        tree[<span class="string">'err'</span>] = sum(labelSet != tree[<span class="string">'mx'</span>])*<span class="number">1.0</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            tree[<span class="string">'err'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                <span class="keyword">if</span> (fabs(labelSet[i] - tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'err'</span>] += <span class="number">1</span></span><br><span class="line">        tree[<span class="string">'sum'</span>] = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.buildTree(datA, labA)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.buildTree(datB, labB)</span><br><span class="line">        tree[<span class="string">'son'</span>] = tree[<span class="string">'left'</span>][<span class="string">'son'</span>] + tree[<span class="string">'right'</span>][<span class="string">'son'</span>]</span><br><span class="line">        tree[<span class="string">'errs'</span>] = tree[<span class="string">'left'</span>][<span class="string">'errs'</span>] + tree[<span class="string">'right'</span>][<span class="string">'errs'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="comment">#对测试集分类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">classifyTest</span><span class="params">(self, tree, test)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (az[x]==<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'val'</span>]</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        val = tree[<span class="string">'val'</span>]</span><br><span class="line">        <span class="keyword">if</span> (test[feat] &lt; val): <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'left'</span>], test)</span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'right'</span>], test)</span><br><span class="line">    <span class="comment">#评估</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">access</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        err = <span class="number">0</span>; yi = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = self.classifyTest(self.tree, self.testSet[i])</span><br><span class="line">            <span class="keyword">if</span> (self.algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                <span class="keyword">if</span> (fabs(lab - self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (lab != self.testLabel[i]): err += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (n - err) * <span class="number">1.0</span> / n</span><br><span class="line">    <span class="comment"># 评估forest</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accessForest</span><span class="params">(self, forest)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        m = len(forest)</span><br><span class="line">        err = <span class="number">0</span>;</span><br><span class="line">        yi = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                lab += self.classifyTest(forest[j], self.testSet[i])</span><br><span class="line">            <span class="keyword">if</span> (self.algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                <span class="keyword">if</span> (fabs(lab / m - self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> (lab &gt; m - lab):</span><br><span class="line">                    lab = <span class="number">1.0</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    lab = <span class="number">0.0</span></span><br><span class="line">                <span class="keyword">if</span> (lab != self.testLabel[i]): err += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (n - err) * <span class="number">1.0</span> / n</span><br><span class="line">    <span class="comment">#代价复杂度后剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningCalc</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            f[x][<span class="number">0</span>] = tree[<span class="string">'sum'</span>]*tree[<span class="string">'Ent'</span>] + alpha</span><br><span class="line">            f[x][<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        f[x][<span class="number">0</span>] = f[le][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[le][<span class="number">1</span>] != <span class="literal">None</span>): f[x][<span class="number">0</span>] = min(f[x][<span class="number">0</span>], f[le][<span class="number">1</span>])</span><br><span class="line">        o = f[ri][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[ri][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[ri][<span class="number">1</span>])</span><br><span class="line">        f[x][<span class="number">0</span>] += o</span><br><span class="line">        f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningDel</span><span class="params">(self, tree, bz)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = f[x][bz]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (bz == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        yi = er =<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> (f[le][i] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> (f[ri][j] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> (f[le][i] + f[ri][j] == f[x][bz]):</span><br><span class="line">                    yi, er = i, j</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'left'</span>], yi)</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'right'</span>], er)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunning</span><span class="params">(self, alpha = <span class="number">1</span>)</span>:</span></span><br><span class="line">        self.costPrunningCalc(self.tree, alpha)</span><br><span class="line">        bz = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (f[<span class="number">1</span>][<span class="number">0</span>] &gt; f[<span class="number">1</span>][<span class="number">1</span>]): bz = <span class="number">1</span></span><br><span class="line">        tsize = [<span class="number">0</span>]</span><br><span class="line">        self.tree = self.costPrunningDel(self.tree, bz)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#错误率降低剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">REPrunning</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(tsize[<span class="number">0</span>],<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> (son[i] == <span class="number">1</span>): <span class="keyword">continue</span></span><br><span class="line">            pre = self.access()</span><br><span class="line">            az[i] = <span class="number">1</span></span><br><span class="line">            now = self.access()</span><br><span class="line">            <span class="keyword">if</span>(now &gt; pre):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>: az[i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#悲观剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcDU</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        le = tree[<span class="string">'left'</span>]</span><br><span class="line">        ri = tree[<span class="string">'right'</span>]</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>]*pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>]*ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span>(meanpre + valpre &gt; meannow):</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcUD</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        le = tree[<span class="string">'left'</span>]</span><br><span class="line">        ri = tree[<span class="string">'right'</span>]</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>] * pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>] * ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span> (meanpre + valpre &gt; meannow)<span class="keyword">and</span>(meanpre - valpre &lt; meannow):</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.PEPrunningCalcUD(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.PEPrunningCalcUD(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunning</span><span class="params">(self, alg, alpha = <span class="number">0.1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (alg == <span class="string">'DU'</span>): self.tree = self.PEPrunningCalcDU(self.tree, alpha)</span><br><span class="line">        <span class="keyword">else</span>: self.tree = self.PEPrunningCalcUD(self.tree, alpha)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#决策树可视化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treePaint</span><span class="params">(self, tree, dotx)</span>:</span></span><br><span class="line">        keyx = self.key</span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            dotx.node(name=str(x), label=str(tree[<span class="string">'val'</span>]), color=<span class="string">'green'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.treePaint(tree[<span class="string">'left'</span>], dotx)</span><br><span class="line">        self.treePaint(tree[<span class="string">'right'</span>], dotx)</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        dotx.node(name=str(x), label=<span class="string">'split to '</span>+str(keyx[tree[<span class="string">'feat'</span>]]), color=<span class="string">'red'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        dotx.edge(str(x), str(le), label=<span class="string">'&lt;'</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">        dotx.edge(str(x), str(ri), label=<span class="string">'&gt;='</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treeVisualize</span><span class="params">(self, nameadd)</span>:</span></span><br><span class="line">        dotx = Digraph(name=<span class="string">'Decision'</span>+<span class="string">'('</span>+nameadd+<span class="string">')'</span>, format=<span class="string">"png"</span>)</span><br><span class="line">        self.treePaint(self.tree, dotx)</span><br><span class="line">        dotx.node(name=<span class="string">'a'</span>, label=<span class="string">'acc: '</span>+str(DCTree.access())+<span class="string">'\n'</span>, color=<span class="string">'blue'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        dotx.view()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ID3决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ID3</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'ID3'</span></span><br><span class="line">    Thresh = (<span class="number">0.0001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#C45决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C45</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'C45'</span></span><br><span class="line">    Thresh = (<span class="number">0.01</span>, <span class="number">10</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#CART决策树,带入参数,C是分类,R是回归</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CART</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (attr == <span class="string">'C'</span>): self.algor = <span class="string">'CARTC'</span></span><br><span class="line">        <span class="keyword">else</span>: self.algor = <span class="string">'CARTR'</span></span><br><span class="line">    Thresh = (<span class="number">0.001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment"># 随机森林</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomForest</span><span class="params">(num)</span>:</span></span><br><span class="line">    forest = []</span><br><span class="line">    treex = CART(<span class="string">'R'</span>)</span><br><span class="line">    treex.dataO = treex.loadDataSet(<span class="string">'diabetesN.csv'</span>)</span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        tsize[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        son[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        treex.BSsplit()</span><br><span class="line">        pp = log(treex.dataSet.shape[<span class="number">1</span>], <span class="number">2</span>)/treex.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        treex.keyRandom(p=pp)</span><br><span class="line">        treex.tree=treex.buildTree(treex.dataSet, treex.labelSet)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(tsize[<span class="number">0</span>]+<span class="number">1</span>):</span><br><span class="line">            f[j][<span class="number">0</span>] = f[j][<span class="number">1</span>] = az[j] = <span class="number">0</span></span><br><span class="line">        treex.PEPrunning(<span class="string">'UD'</span>)</span><br><span class="line">        forest.append(treex.tree)</span><br><span class="line">    treex.dataSplit()</span><br><span class="line">    <span class="keyword">return</span> treex.accessForest(forest)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tsize = [<span class="number">0</span>]</span><br><span class="line">    son = [<span class="number">0</span>]</span><br><span class="line">    DCTree = CART(<span class="string">'R'</span>)</span><br><span class="line">    DCTree.dataO = DCTree.loadDataSet(<span class="string">'diabetesN.csv'</span>)</span><br><span class="line">    f = [[<span class="number">0</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># costPrunning</span></span><br><span class="line">    az = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># REPrunning</span></span><br><span class="line">    keybz = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># randomForest</span></span><br><span class="line">    <span class="comment">#DCTree.PreProcess()</span></span><br><span class="line">    <span class="comment">#DCTree.dataO.to_csv('diabetesN.csv',index=False)</span></span><br><span class="line">    DCTree.dataSplit()</span><br><span class="line">    DCTree.tree=DCTree.buildTree(DCTree.dataSet, DCTree.labelSet)</span><br><span class="line">    print(DCTree.access())</span><br><span class="line">    <span class="comment">#DCTree.treeVisualize('no prunning')</span></span><br><span class="line">    print(DCTree.PEPrunning(<span class="string">'UD'</span>))</span><br><span class="line">    <span class="comment">#DCTree.treeVisualize('PEPrunning')</span></span><br><span class="line">    print(randomForest(<span class="number">20</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Python鲍鱼年龄预测"><a href="#Python鲍鱼年龄预测" class="headerlink" title="Python鲍鱼年龄预测"></a>Python鲍鱼年龄预测</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"><span class="comment">#决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecisionTree</span>:</span></span><br><span class="line">    dataSet = []; testSet = []; dataO = []</span><br><span class="line">    labelSet = []; testLabel = []; key = &#123;&#125;</span><br><span class="line">    strkey = []; valkey = []</span><br><span class="line">    replaceTo = &#123;&#125;; replaceBack = &#123;&#125;</span><br><span class="line">    algor = <span class="string">'None'</span></span><br><span class="line">    Thresh = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line">    tree = &#123;&#125;</span><br><span class="line">    <span class="comment"># 下载数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        fr = read_table(filename, names=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>])</span><br><span class="line">        fr.replace(<span class="string">'?'</span>, nan, inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> fr</span><br><span class="line">    <span class="comment"># 删掉缺失值多的key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delColumn</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        dataIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        delVal = n//<span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> dataIndex:</span><br><span class="line">            <span class="keyword">if</span> (dataSet[inx].isnull().sum() &gt;= delVal):</span><br><span class="line">                dataSet = dataSet.drop(inx, axis=<span class="number">1</span>)</span><br><span class="line">        dataSet.drop(<span class="string">'EmployeeNumber'</span>, axis=<span class="number">1</span>)</span><br><span class="line">        dataSet.drop(<span class="string">'EmployeeCount'</span>, axis=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 寻找异常值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">boxDiagram</span><span class="params">(self, dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        throw = set([])</span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> nIndex:</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (tot <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Attrition'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            <span class="comment"># 排出缺失值</span></span><br><span class="line">            data = data[data.notnull()]</span><br><span class="line">            <span class="comment"># 箱型图</span></span><br><span class="line">            Q1, Q3 = percentile(data, <span class="number">25</span>), percentile(data, <span class="number">75</span>)</span><br><span class="line">            IQR = Q3 - Q1</span><br><span class="line">            throw = throw | set(data[data &gt; Q3 + <span class="number">3</span> * IQR].keys())</span><br><span class="line">            throw = throw | set(data[data &lt; Q1 - <span class="number">3</span> * IQR].keys())</span><br><span class="line">            <span class="comment"># 温和异常值判为缺失值</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &gt; Q3 + <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">            dataSet.loc[(dataSet[inx] &lt; Q1 - <span class="number">1.5</span> * IQR), inx] = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> throw:</span><br><span class="line">            dataSet = dataSet.drop(i, axis=<span class="number">0</span>)</span><br><span class="line">        dataSet.dropna(axis=<span class="number">0</span>, how=<span class="string">"all"</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        dataSet = dataSet.reindex(range(dataSet.shape[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 计算距离</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">OjiDist</span><span class="params">(self,dataSet, x, y, m)</span>:</span></span><br><span class="line">        z = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">if</span> (str(dataSet.iloc[x, i]) == <span class="string">'nan'</span>) <span class="keyword">or</span> (str(dataSet.iloc[y, i]) == <span class="string">'nan'</span>): <span class="keyword">continue</span>;</span><br><span class="line">            z += (dataSet.iloc[x, i] - dataSet.iloc[y, i]) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> sqrt(z)</span><br><span class="line">    <span class="comment"># 处理缺失值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solveMissing</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="string">"""for i in range(n):</span></span><br><span class="line"><span class="string">            if (dataSet.iloc[i].isnull().sum() == 0): continue</span></span><br><span class="line"><span class="string">            mini = 0</span></span><br><span class="line"><span class="string">            distMin = inf</span></span><br><span class="line"><span class="string">            for j in range(n):</span></span><br><span class="line"><span class="string">                if (i == j): continue</span></span><br><span class="line"><span class="string">                if (dataSet.iloc[j].isnull().sum() &gt; 0): continue</span></span><br><span class="line"><span class="string">                distx = self.OjiDist(dataSet, i, j, m)</span></span><br><span class="line"><span class="string">                if (distx &lt; distMin):</span></span><br><span class="line"><span class="string">                    distMin = distx</span></span><br><span class="line"><span class="string">                    mini = j</span></span><br><span class="line"><span class="string">            for j in range(m):</span></span><br><span class="line"><span class="string">                if (str(dataSet.iloc[i, j]) == 'nan'): dataSet.iloc[i, j] = dataSet.iloc[mini, j]"""</span></span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nIndex:</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            data = dataSet[i]</span><br><span class="line">            <span class="keyword">if</span> (i==<span class="string">'a'</span>): meanx = median(data[data.notnull()])</span><br><span class="line">            <span class="keyword">elif</span> (tot <span class="keyword">in</span> self.strkey): meanx = dataSet[i].mode()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>: meanx = mean(data[data.notnull()])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                <span class="keyword">if</span> (str(dataSet.loc[j, i]) == <span class="string">'nan'</span>):</span><br><span class="line">                    dataSet.loc[j, i] = meanx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 记录离散值和连续值的key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitStrVal</span><span class="params">(self)</span>:</span></span><br><span class="line">        tot = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Attrition'</span>): <span class="keyword">continue</span></span><br><span class="line">            x = self.dataO.loc[<span class="number">1</span>, inx]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (isinstance(x, str)):</span><br><span class="line">                self.valkey.append(tot)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.strkey.append(tot)</span><br><span class="line">    <span class="comment"># 将离散值标号</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceStr</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        nIndex = dataSet.keys()</span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> nIndex:</span><br><span class="line">            x = self.dataO.loc[<span class="number">1</span>, inx]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (isinstance(x, str)): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                y = dataSet.loc[j, inx]</span><br><span class="line">                <span class="keyword">if</span> (y <span class="keyword">not</span> <span class="keyword">in</span> self.replaceTo):</span><br><span class="line">                    tot+=<span class="number">1</span></span><br><span class="line">                    self.replaceTo[y] = tot</span><br><span class="line">                    self.replaceBack[tot] = y</span><br><span class="line">                self.dataO.loc[j, inx] = self.replaceTo[y]</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 特征标准化处理</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">standardize</span><span class="params">(self,dataSet)</span>:</span></span><br><span class="line">        n, m = dataSet.shape[<span class="number">0</span>], dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        keyN = dataSet.keys()</span><br><span class="line">        <span class="keyword">for</span> inx <span class="keyword">in</span> keyN:</span><br><span class="line">            <span class="keyword">if</span> (inx == <span class="string">'Outcome'</span>): <span class="keyword">continue</span></span><br><span class="line">            data = dataSet[inx]</span><br><span class="line">            meanx = data.mean()</span><br><span class="line">            stdx = data.std()</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(n):</span><br><span class="line">                dataSet.loc[j, inx] = (dataSet.loc[j, inx] - meanx) / stdx</span><br><span class="line">        <span class="keyword">return</span> dataSet</span><br><span class="line">    <span class="comment"># 预处理模块</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PreProcess</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.dataO = self.delColumn(self.dataO)</span><br><span class="line">        self.dataO[<span class="string">'Attrition'</span>].replace(<span class="string">'Yes'</span>, <span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        self.dataO[<span class="string">'Attrition'</span>].replace(<span class="string">'No'</span>, <span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        self.splitStrVal()</span><br><span class="line">        self.dataO = self.boxDiagram(self.dataO)</span><br><span class="line">        self.dataO = self.solveMissing(self.dataO)</span><br><span class="line">        <span class="comment">#self.dataO = self.standardize(self.dataO)</span></span><br><span class="line">        <span class="comment"># 数据划分留出法</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""def dataSplit(self, P=0.7):</span></span><br><span class="line"><span class="string">        dataSet = [];</span></span><br><span class="line"><span class="string">        testSet = []</span></span><br><span class="line"><span class="string">        labelSet = [];</span></span><br><span class="line"><span class="string">        testLabel = []</span></span><br><span class="line"><span class="string">        key = &#123;&#125;;</span></span><br><span class="line"><span class="string">        tot = 0</span></span><br><span class="line"><span class="string">        for i in self.dataO.keys():</span></span><br><span class="line"><span class="string">            key[tot] = i</span></span><br><span class="line"><span class="string">            tot += 1</span></span><br><span class="line"><span class="string">        n = self.dataO.shape[0]</span></span><br><span class="line"><span class="string">        S = 0</span></span><br><span class="line"><span class="string">        for i in self.dataO['Outcome']:</span></span><br><span class="line"><span class="string">            if (i == 1.0): S += 1</span></span><br><span class="line"><span class="string">        N = n - S;</span></span><br><span class="line"><span class="string">        S = P * S</span></span><br><span class="line"><span class="string">        N = P * N;</span></span><br><span class="line"><span class="string">        SS = NN = 0</span></span><br><span class="line"><span class="string">        for i in range(n):</span></span><br><span class="line"><span class="string">            p = random.random()</span></span><br><span class="line"><span class="string">            # p = 0.1*(i%10)</span></span><br><span class="line"><span class="string">            data = self.dataO.iloc[i]</span></span><br><span class="line"><span class="string">            if (p &lt;= P):</span></span><br><span class="line"><span class="string">                if (data[7] == 1.0) and (SS &gt;= S): p = 1.0 - p</span></span><br><span class="line"><span class="string">                if (data[7] == 0.0) and (NN &gt;= N): p = 1.0 - p</span></span><br><span class="line"><span class="string">            if (p &lt;= P):</span></span><br><span class="line"><span class="string">                if (data[7] == 1.0):</span></span><br><span class="line"><span class="string">                    SS += 1</span></span><br><span class="line"><span class="string">                else:</span></span><br><span class="line"><span class="string">                    NN += 1</span></span><br><span class="line"><span class="string">                dataSet.append(data[:7]), labelSet.append(data[7])</span></span><br><span class="line"><span class="string">            else:</span></span><br><span class="line"><span class="string">                testSet.append(data[:7]), testLabel.append(data[7])</span></span><br><span class="line"><span class="string">        self.dataSet = array(dataSet)</span></span><br><span class="line"><span class="string">        self.labelSet = array(labelSet)</span></span><br><span class="line"><span class="string">        self.testSet = array(testSet)</span></span><br><span class="line"><span class="string">        self.testLabel = array(testLabel)</span></span><br><span class="line"><span class="string">        self.key = key</span></span><br><span class="line"><span class="string">        # 自助法划分</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def BSsplit(self):</span></span><br><span class="line"><span class="string">        n = self.dataO.shape[0]</span></span><br><span class="line"><span class="string">        dataSet = [];</span></span><br><span class="line"><span class="string">        testSet = []</span></span><br><span class="line"><span class="string">        labelSet = [];</span></span><br><span class="line"><span class="string">        testLabel = []</span></span><br><span class="line"><span class="string">        dataIndex = []</span></span><br><span class="line"><span class="string">        key = &#123;&#125;;</span></span><br><span class="line"><span class="string">        tot = 0</span></span><br><span class="line"><span class="string">        for i in self.dataO.keys():</span></span><br><span class="line"><span class="string">            key[tot] = i</span></span><br><span class="line"><span class="string">            tot += 1</span></span><br><span class="line"><span class="string">        for i in range(n):</span></span><br><span class="line"><span class="string">            x = random.randint(0, n - 1)</span></span><br><span class="line"><span class="string">            dataIndex.append(x)</span></span><br><span class="line"><span class="string">        setIndex = set(dataIndex)</span></span><br><span class="line"><span class="string">        for i in range(n):</span></span><br><span class="line"><span class="string">            data = self.dataO.iloc[dataIndex[i]]</span></span><br><span class="line"><span class="string">            dataSet.append(data[:7]), labelSet.append(data[7])</span></span><br><span class="line"><span class="string">            data = self.dataO.iloc[i]</span></span><br><span class="line"><span class="string">            if (i not in setIndex): testSet.append(data[:7]), testLabel.append(data[7])</span></span><br><span class="line"><span class="string">        self.dataSet = array(dataSet)</span></span><br><span class="line"><span class="string">        self.labelSet = array(labelSet)</span></span><br><span class="line"><span class="string">        self.testSet = array(testSet)</span></span><br><span class="line"><span class="string">        self.testLabel = array(testLabel)</span></span><br><span class="line"><span class="string">        self.key = key"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据划分留出法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dataSplit</span><span class="params">(self,P = <span class="number">0.8</span>)</span>:</span></span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="comment">#p = random.random()</span></span><br><span class="line">            p = <span class="number">0.1</span>*(i%<span class="number">10</span>)</span><br><span class="line">            data = list(self.dataO.iloc[i])</span><br><span class="line">            <span class="keyword">if</span> (p &lt;= P):</span><br><span class="line">                dataSet.append(data[:<span class="number">-1</span>]), labelSet.append(data[<span class="number">-1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                testSet.append(data[:<span class="number">-1</span>]), testLabel.append(data[<span class="number">-1</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 自助法划分</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">BSsplit</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.dataO.shape[<span class="number">0</span>]</span><br><span class="line">        dataSet = []; testSet = []</span><br><span class="line">        labelSet = []; testLabel = []</span><br><span class="line">        dataIndex = []</span><br><span class="line">        key = &#123;&#125;; tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.dataO.keys():</span><br><span class="line">            key[tot] = i</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            x = random.randint(<span class="number">0</span>, n - <span class="number">1</span>)</span><br><span class="line">            dataIndex.append(x)</span><br><span class="line">        setIndex = set(dataIndex)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            data = list(self.dataO.iloc[dataIndex[i]])</span><br><span class="line">            dataSet.append(data[:<span class="number">-1</span>]), labelSet.append(data[<span class="number">-1</span>])</span><br><span class="line">            data = self.dataO.iloc[i]</span><br><span class="line">            <span class="keyword">if</span> (i <span class="keyword">not</span> <span class="keyword">in</span> setIndex): testSet.append(data[:<span class="number">-1</span>]), testLabel.append(data[<span class="number">-1</span>])</span><br><span class="line">        self.dataSet = array(dataSet)</span><br><span class="line">        self.labelSet = array(labelSet)</span><br><span class="line">        self.testSet = array(testSet)</span><br><span class="line">        self.testLabel = array(testLabel)</span><br><span class="line">        self.key = key</span><br><span class="line">    <span class="comment"># 随机k个特征</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keyRandom</span><span class="params">(self, p=<span class="number">0.7</span>)</span>:</span></span><br><span class="line">        m = self.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">            keybz[i] = <span class="number">1</span></span><br><span class="line">        upx = m*p;</span><br><span class="line">        arr = arange(m)</span><br><span class="line">        random.shuffle(arr)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(round(upx)):</span><br><span class="line">            keybz[arr[i]] = <span class="number">0</span></span><br><span class="line">    <span class="comment">#香农熵</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcShannonEnt</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Ent = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key]/n)</span><br><span class="line">            Ent -= prob*log(prob,<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> Ent</span><br><span class="line">    <span class="comment">#基尼不纯度</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcGink</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        n = labelSet.shape[<span class="number">0</span>]</span><br><span class="line">        Gink = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> classX.keys():</span><br><span class="line">            prob = float(classX[key] / n)</span><br><span class="line">            Gink -= prob*prob</span><br><span class="line">        <span class="keyword">return</span> Gink</span><br><span class="line">    <span class="comment">#计算标准差*长度</span></span><br><span class="line">    <span class="comment"># 计算均值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcMean</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> mean(labelSet)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcSqrError</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        meanx = mean(labelSet)</span><br><span class="line">        Dvalue = labelSet - tile(meanx,(labelSet.shape[<span class="number">0</span>], <span class="number">1</span>))</span><br><span class="line">        Dvalue = Dvalue**<span class="number">2</span></span><br><span class="line">        sumx = sum(Dvalue)</span><br><span class="line">        <span class="keyword">return</span> sumx</span><br><span class="line">        <span class="comment">#return 1</span></span><br><span class="line"></span><br><span class="line">    calc = &#123;<span class="string">'ID3'</span>: calcShannonEnt, <span class="string">'C45'</span>: calcShannonEnt, <span class="string">'CARTC'</span>: calcGink</span><br><span class="line">            ,<span class="string">'CARTR'</span>: calcSqrError&#125;</span><br><span class="line">    <span class="comment">#统计label的各个值的数量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcClass</span><span class="params">(self, labelSet)</span>:</span></span><br><span class="line">        classX = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">            lab = labelSet[i]</span><br><span class="line">            classX[lab] = classX.get(lab, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> classX</span><br><span class="line">    <span class="comment">#按照feat和val分离数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitToFeat</span><span class="params">(self, dataSet, labelSet, feat, val)</span>:</span></span><br><span class="line">        datA = dataSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        labA = labelSet[nonzero(dataSet[:, feat] &lt; val)[<span class="number">0</span>]]</span><br><span class="line">        datB = dataSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        labB = labelSet[nonzero(dataSet[:, feat] &gt;= val)[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> datA, labA, datB, labB</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splitToSame</span><span class="params">(self, dataSet, labelSet, feat, val)</span>:</span></span><br><span class="line">        dat = dataSet[nonzero(dataSet[:, feat] == val)[<span class="number">0</span>]]</span><br><span class="line">        lab = labelSet[nonzero(dataSet[:, feat] == val)[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> dat, lab</span><br><span class="line">    <span class="comment">#计算叶子节点的标签</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calcLeave</span><span class="params">(self, labelSet, algor)</span>:</span></span><br><span class="line">        treshVal = self.treshVal</span><br><span class="line">        <span class="comment"># 找label中的均值</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            o = self.calcMean(labelSet)</span><br><span class="line">            <span class="keyword">return</span> o</span><br><span class="line">        <span class="comment"># 找label中的最多的</span></span><br><span class="line">        classX = self.calcClass(labelSet)</span><br><span class="line">        sortX = sorted(classX.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> sortX[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#找当前分界点</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chooseBest</span><span class="params">(self, dataSet, labelSet, algor, Thresh)</span>:</span></span><br><span class="line">        n, m = shape(dataSet)</span><br><span class="line">        <span class="keyword">if</span> (sum(labelSet==labelSet[<span class="number">0</span>])==n):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, labelSet[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (m == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        EntO = self.calc[algor](self,labelSet)</span><br><span class="line">        BEnt = inf; Bfeat = Bval = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> range(m):</span><br><span class="line">                <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">                a = dataSet[:, feat]</span><br><span class="line">                <span class="keyword">if</span> (max(a)==min(a)): <span class="keyword">continue</span></span><br><span class="line">                setX = list(sorted(set(a)))</span><br><span class="line">                val = mean(a)</span><br><span class="line">            <span class="comment">#for j in range(len(setX)-1):</span></span><br><span class="line">            <span class="comment">#for val in setX:</span></span><br><span class="line">                <span class="comment">#if(val==max(setX))or(val==min(setX)): continue</span></span><br><span class="line">                <span class="comment">#val = (setX[j] + setX[j+1]) / 2.0</span></span><br><span class="line">                datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, feat, val)</span><br><span class="line">                probA = float((datA.shape[<span class="number">0</span>])/n)</span><br><span class="line">                probB = float((datB.shape[<span class="number">0</span>])/n)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                    probA = probB = <span class="number">1.0</span></span><br><span class="line">                Ent = probA*self.calc[algor](self,labA) + probB*self.calc[algor](self,labB)</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'C45'</span>):</span><br><span class="line">                    Ent = Ent/(self.calc[algor](self,a) + <span class="number">0.1</span>)</span><br><span class="line">                <span class="keyword">if</span> (Ent &lt; BEnt):</span><br><span class="line">                    BEnt, Bfeat, Bval = Ent, feat, val</span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="keyword">if</span> (feat <span class="keyword">not</span> <span class="keyword">in</span> self.strkey): <span class="keyword">continue</span></span><br><span class="line">            a = dataSet[:, feat]</span><br><span class="line">            setX = list(sorted(set(a)))</span><br><span class="line">            Ent = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> setX:</span><br><span class="line">                dat, lab = self.splitToSame(dataSet, labelSet, feat, val)</span><br><span class="line">                numx = lab.shape[<span class="number">0</span>]</span><br><span class="line">                prob = numx*<span class="number">1.0</span>/n</span><br><span class="line">                <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>): prob = <span class="number">1.0</span></span><br><span class="line">                Ent += prob*self.calc[algor](self, lab)</span><br><span class="line">            <span class="keyword">if</span> (algor == <span class="string">'C45'</span>):</span><br><span class="line">                Ent = Ent / (self.calc[algor](self, a) + <span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">if</span> (Ent &lt; BEnt):</span><br><span class="line">                BEnt, Bfeat = Ent, feat</span><br><span class="line">        <span class="keyword">if</span> (EntO-BEnt&lt;Thresh[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        <span class="keyword">if</span> (datA.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>])<span class="keyword">and</span>(datB.shape[<span class="number">0</span>] &lt; Thresh[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, self.calcLeave(labelSet, algor)</span><br><span class="line">        <span class="keyword">return</span> Bfeat, Bval</span><br><span class="line">    <span class="comment">#建树</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">buildTree</span><span class="params">(self, dataSet, labelSet)</span>:</span></span><br><span class="line">        algor = self.algor</span><br><span class="line">        Thresh = self.Thresh</span><br><span class="line">        Bfeat ,Bval= self.chooseBest(dataSet, labelSet, algor, Thresh)</span><br><span class="line">        <span class="keyword">if</span> (Bfeat == <span class="literal">None</span>):</span><br><span class="line">            tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">            son.append(<span class="number">1</span>)</span><br><span class="line">            tree = &#123;<span class="string">'val'</span>: Bval, <span class="string">'num'</span>: tsize[<span class="number">0</span>], <span class="string">'Ent'</span>: self.calc[algor](self, labelSet)</span><br><span class="line">                    , <span class="string">'sum'</span>: dataSet.shape[<span class="number">0</span>], <span class="string">'mx'</span>:self.calcLeave(labelSet, algor),</span><br><span class="line">                    <span class="string">'err'</span>: sum(labelSet != self.calcLeave(labelSet, algor))*<span class="number">1.0</span>,</span><br><span class="line">                    <span class="string">'son'</span>: <span class="number">1</span>, <span class="string">'errs'</span>: sum(labelSet != self.calcLeave(labelSet, algor))*<span class="number">1.0</span>&#125;</span><br><span class="line">            <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">                tree[<span class="string">'errs'</span>] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                    <span class="keyword">if</span> (fabs(labelSet[i]-tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'errs'</span>] += <span class="number">1</span></span><br><span class="line">                tree[<span class="string">'err'</span>] = tree[<span class="string">'errs'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        tsize[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        son.append(<span class="number">0</span>)</span><br><span class="line">        tree = &#123;&#125;</span><br><span class="line">        tree[<span class="string">'feat'</span>] = Bfeat</span><br><span class="line">        tree[<span class="string">'val'</span>] = Bval</span><br><span class="line">        tree[<span class="string">'num'</span>] = tsize[<span class="number">0</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = self.calc[algor](self, labelSet)</span><br><span class="line">        tree[<span class="string">'mx'</span>] = self.calcLeave(labelSet, algor)</span><br><span class="line">        tree[<span class="string">'err'</span>] = sum(labelSet != tree[<span class="string">'mx'</span>])*<span class="number">1.0</span></span><br><span class="line">        <span class="keyword">if</span> (algor == <span class="string">'CARTR'</span>):</span><br><span class="line">            tree[<span class="string">'err'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(labelSet.shape[<span class="number">0</span>]):</span><br><span class="line">                <span class="keyword">if</span> (fabs(labelSet[i] - tree[<span class="string">'mx'</span>]) &gt; self.treshVal): tree[<span class="string">'err'</span>] += <span class="number">1</span></span><br><span class="line">        tree[<span class="string">'sum'</span>] = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (Bfeat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            a = dataSet[:, Bfeat]</span><br><span class="line">            setX = list(sorted(set(a)))</span><br><span class="line">            Ent = <span class="number">0</span></span><br><span class="line">            tree[<span class="string">'val'</span>] = setX</span><br><span class="line">            tree[<span class="string">'son'</span>] = tree[<span class="string">'errs'</span>] = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> setX:</span><br><span class="line">                dat, lab = self.splitToSame(dataSet, labelSet, Bfeat, val)</span><br><span class="line">                <span class="keyword">if</span>(lab.shape[<span class="number">0</span>]==<span class="number">0</span>):</span><br><span class="line">                    ans=<span class="number">1</span></span><br><span class="line">                tree[val] = self.buildTree(dat, lab)</span><br><span class="line">                tree[<span class="string">'son'</span>] += tree[val][<span class="string">'son'</span>]</span><br><span class="line">                tree[<span class="string">'errs'</span>] += tree[val][<span class="string">'errs'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        datA, labA, datB, labB = self.splitToFeat(dataSet, labelSet, Bfeat, Bval)</span><br><span class="line">        tree[<span class="string">'left'</span>] = self.buildTree(datA, labA)</span><br><span class="line">        tree[<span class="string">'right'</span>] = self.buildTree(datB, labB)</span><br><span class="line">        tree[<span class="string">'son'</span>] = tree[<span class="string">'left'</span>][<span class="string">'son'</span>] + tree[<span class="string">'right'</span>][<span class="string">'son'</span>]</span><br><span class="line">        tree[<span class="string">'errs'</span>] = tree[<span class="string">'left'</span>][<span class="string">'errs'</span>] + tree[<span class="string">'right'</span>][<span class="string">'errs'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="comment">#对测试集分类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">classifyTest</span><span class="params">(self, tree, test)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (az[x]==<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'val'</span>]</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        val = tree[<span class="string">'val'</span>]</span><br><span class="line">        <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                <span class="keyword">if</span> (i == test[feat]):</span><br><span class="line">                    <span class="keyword">return</span> self.classifyTest(tree[i], test)</span><br><span class="line">            <span class="keyword">return</span> tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">if</span> (test[feat] &lt; val): <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'left'</span>], test)</span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">return</span> self.classifyTest(tree[<span class="string">'right'</span>], test)</span><br><span class="line">    <span class="comment">#评估</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">access</span><span class="params">(self)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        err = <span class="number">0</span>;yi=<span class="number">0</span></span><br><span class="line">        cha = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = self.classifyTest(self.tree, self.testSet[i])</span><br><span class="line">            <span class="keyword">if</span>(fabs(lab-self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            cha += (lab-self.testLabel[i])**<span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> (n-err)*<span class="number">1.0</span>/n,cha</span><br><span class="line">    <span class="comment"># 评估forest</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">accessForest</span><span class="params">(self, forest)</span>:</span></span><br><span class="line">        n = self.testLabel.shape[<span class="number">0</span>]</span><br><span class="line">        m = len(forest)</span><br><span class="line">        err = <span class="number">0</span>; cha = <span class="number">0</span></span><br><span class="line">        yi = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            lab = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">                lab += self.classifyTest(forest[j],self.testSet[i])</span><br><span class="line">            lab /= m</span><br><span class="line">            <span class="keyword">if</span>(fabs(lab-self.testLabel[i]) &gt; self.treshVal): err += <span class="number">1</span></span><br><span class="line">            cha += (lab - self.testLabel[i]) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> (n - err) * <span class="number">1.0</span> / n,cha</span><br><span class="line">    <span class="comment">#代价复杂度后剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningCalc</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            f[x][<span class="number">0</span>] = tree[<span class="string">'sum'</span>]*tree[<span class="string">'Ent'</span>] + alpha</span><br><span class="line">            f[x][<span class="number">1</span>] = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            f[x][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                self.costPrunningCalc(tree[i], alpha)</span><br><span class="line">                o = f[son][<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> (f[son][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[son][<span class="number">1</span>])</span><br><span class="line">                f[x][<span class="number">0</span>] += o</span><br><span class="line">            f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">        self.costPrunningCalc(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        f[x][<span class="number">0</span>] = f[le][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[le][<span class="number">1</span>] != <span class="literal">None</span>): f[x][<span class="number">0</span>] = min(f[x][<span class="number">0</span>], f[le][<span class="number">1</span>])</span><br><span class="line">        o = f[ri][<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (f[ri][<span class="number">1</span>] != <span class="literal">None</span>): o = min(o, f[ri][<span class="number">1</span>])</span><br><span class="line">        f[x][<span class="number">0</span>] += o</span><br><span class="line">        f[x][<span class="number">1</span>] = tree[<span class="string">'Ent'</span>]*tree[<span class="string">'sum'</span>] + alpha</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunningDel</span><span class="params">(self, tree, bz)</span>:</span></span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        tree[<span class="string">'Ent'</span>] = f[x][bz]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        feat = tree[<span class="string">'feat'</span>]</span><br><span class="line">        <span class="keyword">if</span> (bz == <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (feat <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            lenx = len(val)</span><br><span class="line">            <span class="keyword">for</span> bin <span class="keyword">in</span> range(<span class="number">1</span>&lt;&lt;lenx):</span><br><span class="line">                tot = <span class="number">-1</span></span><br><span class="line">                o = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    tot += <span class="number">1</span></span><br><span class="line">                    l = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                    son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                    <span class="keyword">if</span> (f[son][l] == <span class="literal">None</span>):</span><br><span class="line">                        tot = <span class="number">-2</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    o += f[son][l]</span><br><span class="line">                <span class="keyword">if</span> (o != f[x][bz]): tot = <span class="number">-2</span></span><br><span class="line">                <span class="keyword">if</span> (tot != <span class="number">-2</span>):</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                        tot += <span class="number">0</span></span><br><span class="line">                        l = <span class="number">0</span></span><br><span class="line">                        <span class="keyword">if</span> ((bin &amp; (<span class="number">1</span> &lt;&lt; tot)) &gt; <span class="number">0</span>): l = <span class="number">1</span></span><br><span class="line">                        self.costPrunningCalc(tree[i], l)</span><br><span class="line">                    <span class="keyword">return</span> tree</span><br><span class="line">        le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">        yi = er =<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> (f[le][i] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">if</span> (f[ri][j] == <span class="literal">None</span>): <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> (f[le][i] + f[ri][j] == f[x][bz]):</span><br><span class="line">                    yi, er = i, j</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'left'</span>], yi)</span><br><span class="line">        self.costPrunningDel(tree[<span class="string">'right'</span>], er)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">costPrunning</span><span class="params">(self, alpha = <span class="number">10</span>)</span>:</span></span><br><span class="line">        self.costPrunningCalc(self.tree, alpha)</span><br><span class="line">        bz = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> (f[<span class="number">1</span>][<span class="number">0</span>] &gt; f[<span class="number">1</span>][<span class="number">1</span>]): bz = <span class="number">1</span></span><br><span class="line">        tsize = [<span class="number">0</span>]</span><br><span class="line">        self.tree = self.costPrunningDel(self.tree, bz)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#错误率降低剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">REPrunning</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(tsize[<span class="number">0</span>],<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> (son[i] == <span class="number">1</span>): <span class="keyword">continue</span></span><br><span class="line">            pre = self.access()</span><br><span class="line">            az[i] = <span class="number">1</span></span><br><span class="line">            now = self.access()</span><br><span class="line">            <span class="keyword">if</span>(now &gt; pre):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>: az[i] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#悲观剪枝</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcDU</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">            tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>]*pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>]*ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span>(meanpre + valpre &gt; meannow):</span><br><span class="line">            <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunningCalcUD</span><span class="params">(self, tree, alpha)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        pnow = (tree[<span class="string">'err'</span>] + alpha) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        ppre = (tree[<span class="string">'errs'</span>] + alpha * tree[<span class="string">'son'</span>]) / tree[<span class="string">'sum'</span>]</span><br><span class="line">        meannow = tree[<span class="string">'sum'</span>] * pnow</span><br><span class="line">        meanpre = tree[<span class="string">'sum'</span>] * ppre</span><br><span class="line">        valnow = sqrt(pnow * (<span class="number">1</span> - pnow) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        valpre = sqrt(ppre * (<span class="number">1</span> - ppre) * tree[<span class="string">'sum'</span>])</span><br><span class="line">        <span class="keyword">if</span> (meanpre + valpre &gt; meannow):</span><br><span class="line">            <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">                val = tree[<span class="string">'val'</span>]</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                    <span class="keyword">del</span> tree[i]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'left'</span>]</span><br><span class="line">                <span class="keyword">del</span> tree[<span class="string">'right'</span>]</span><br><span class="line">            <span class="keyword">del</span> tree[<span class="string">'feat'</span>]</span><br><span class="line">            tree[<span class="string">'val'</span>] = tree[<span class="string">'mx'</span>]</span><br><span class="line">            <span class="keyword">return</span> tree</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                tree[i] = self.PEPrunningCalcDU(tree[i], alpha)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tree[<span class="string">'left'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'left'</span>], alpha)</span><br><span class="line">            tree[<span class="string">'right'</span>] = self.PEPrunningCalcDU(tree[<span class="string">'right'</span>], alpha)</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PEPrunning</span><span class="params">(self, alpha = <span class="number">0.1</span>)</span>:</span></span><br><span class="line">        self.tree = self.PEPrunningCalcUD(self.tree, alpha)</span><br><span class="line">        <span class="keyword">return</span> self.access()</span><br><span class="line">    <span class="comment">#决策树可视化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treePaint</span><span class="params">(self, tree, dotx)</span>:</span></span><br><span class="line">        keyx = self.key</span><br><span class="line">        x = tree[<span class="string">'num'</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'feat'</span> <span class="keyword">not</span> <span class="keyword">in</span> tree):</span><br><span class="line">            dotx.node(name=str(x), label=str(tree[<span class="string">'val'</span>]), color=<span class="string">'green'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                self.treePaint(tree[i], dotx)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.treePaint(tree[<span class="string">'left'</span>], dotx)</span><br><span class="line">            self.treePaint(tree[<span class="string">'right'</span>], dotx)</span><br><span class="line">        dotx.node(name=str(x), label=<span class="string">'split to '</span>+str(keyx[tree[<span class="string">'feat'</span>]]), color=<span class="string">'red'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        <span class="keyword">if</span> (tree[<span class="string">'feat'</span>] <span class="keyword">in</span> self.strkey):</span><br><span class="line">            val = tree[<span class="string">'val'</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> val:</span><br><span class="line">                son = tree[i][<span class="string">'num'</span>]</span><br><span class="line">                dotx.edge(str(x), str(son), label=<span class="string">'is '</span> + str(self.replaceBack[i]), color=<span class="string">'black'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            le, ri = tree[<span class="string">'left'</span>][<span class="string">'num'</span>], tree[<span class="string">'right'</span>][<span class="string">'num'</span>]</span><br><span class="line">            dotx.edge(str(x), str(le), label=<span class="string">'&lt;'</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">            dotx.edge(str(x), str(ri), label=<span class="string">'&gt;='</span> + str(tree[<span class="string">'val'</span>].round(<span class="number">3</span>)), color=<span class="string">'black'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">treeVisualize</span><span class="params">(self, nameadd)</span>:</span></span><br><span class="line">        dotx = Digraph(name=<span class="string">'Decision'</span>+<span class="string">'('</span>+nameadd+<span class="string">')'</span>, format=<span class="string">"png"</span>)</span><br><span class="line">        self.treePaint(self.tree, dotx)</span><br><span class="line">        dotx.node(name=<span class="string">'a'</span>, label=<span class="string">'acc: '</span>+str(DCTree.access())+<span class="string">'\n'</span>, color=<span class="string">'blue'</span>, shape=<span class="string">'box'</span>)</span><br><span class="line">        dotx.view()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ID3决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ID3</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'ID3'</span></span><br><span class="line">    Thresh = (<span class="number">0.0001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#C45决策树</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C45</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">'C45'</span></span><br><span class="line">    Thresh = (<span class="number">0.01</span>, <span class="number">10</span>)</span><br><span class="line">    treshVal = <span class="number">0.5</span></span><br><span class="line"><span class="comment">#CART决策树,带入参数,C是分类,R是回归</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CART</span><span class="params">(DecisionTree)</span>:</span></span><br><span class="line">    algor = <span class="string">''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (attr == <span class="string">'C'</span>): self.algor = <span class="string">'CARTC'</span></span><br><span class="line">        <span class="keyword">else</span>: self.algor = <span class="string">'CARTR'</span></span><br><span class="line">    Thresh = (<span class="number">0.001</span>, <span class="number">8</span>)</span><br><span class="line">    treshVal = <span class="number">2</span></span><br><span class="line"><span class="comment"># 随机森林</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomForest</span><span class="params">(num, filename)</span>:</span></span><br><span class="line">    forest = []</span><br><span class="line">    treex = CART(<span class="string">'C'</span>)</span><br><span class="line">    treex.dataO = treex.loadDataSet(filename)</span><br><span class="line">    treex.splitStrVal()</span><br><span class="line">    treex.dataO = treex.replaceStr(treex.dataO)</span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">        tsize[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        son[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">        treex.BSsplit()</span><br><span class="line">        pp = log(treex.dataSet.shape[<span class="number">1</span>], <span class="number">2</span>)/treex.dataSet.shape[<span class="number">1</span>]</span><br><span class="line">        <span class="comment">#pp =1</span></span><br><span class="line">        treex.keyRandom(p=pp)</span><br><span class="line">        treex.tree=treex.buildTree(treex.dataSet, treex.labelSet)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(tsize[<span class="number">0</span>]+<span class="number">1</span>):</span><br><span class="line">            f[j][<span class="number">0</span>] = f[j][<span class="number">1</span>] = az[j] = <span class="number">0</span></span><br><span class="line">        treex.PEPrunning()</span><br><span class="line">        forest.append(treex.tree)</span><br><span class="line">    treex.dataSplit()</span><br><span class="line">    <span class="keyword">return</span> treex.accessForest(forest)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tsize = [<span class="number">0</span>]</span><br><span class="line">    son = [<span class="number">0</span>]</span><br><span class="line">    DCTree = CART(<span class="string">'R'</span>)</span><br><span class="line">    DCTree.dataO = DCTree.loadDataSet(<span class="string">'abalone.txt'</span>)</span><br><span class="line">    f = [[<span class="number">0</span>, <span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># costPrunning</span></span><br><span class="line">    az = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># REPrunning</span></span><br><span class="line">    keybz = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(DCTree.dataO.shape[<span class="number">0</span>] + <span class="number">1</span>)]  <span class="comment"># randomForest</span></span><br><span class="line">    <span class="comment">#DCTree.PreProcess()</span></span><br><span class="line">    <span class="comment">#DCTree.dataO.to_csv('employeeFiredN.csv', index=False)</span></span><br><span class="line">    <span class="comment">#DCTree.splitStrVal()</span></span><br><span class="line">    <span class="comment">#DCTree.dataO = DCTree.replaceStr(DCTree.dataO)</span></span><br><span class="line">    DCTree.dataSplit()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(DCTree.strkey)): DCTree.strkey[i] -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(DCTree.valkey)): DCTree.valkey[i] -= <span class="number">1</span></span><br><span class="line">    DCTree.tree=DCTree.buildTree(DCTree.dataSet, DCTree.labelSet)</span><br><span class="line">    print(DCTree.access())</span><br><span class="line">    print(DCTree.PEPrunning())</span><br><span class="line">    print(randomForest(<span class="number">20</span>,<span class="string">'abalone.txt'</span>))</span><br></pre></td></tr></table></figure>





<h2 id="提升树"><a href="#提升树" class="headerlink" title="提升树"></a>提升树</h2><h3 id="用于回归"><a href="#用于回归" class="headerlink" title="用于回归"></a>用于回归</h3><ul>
<li>提升树的思路很简单<ul>
<li>1、一开始初始化一个label数组</li>
<li>2、每次决策树中的训练的数据的值，是label数组与真实值的残差</li>
<li>3、学习这些残差，更新label数组，训练用回归树，不过只用一层</li>
<li>4、没了，不过要保证每次的最优分割点不一样，不然每次都会在同一个地方分开</li>
</ul>
</li>
</ul>
<h2 id="GDBT"><a href="#GDBT" class="headerlink" title="GDBT"></a>GDBT</h2><ul>
<li>上面的提升树是训练残差，残差相当于${1\over 2}(y-x)^2$的梯度</li>
<li>而在此我们可以直接考虑一个可为函数的来当做误差，然后每次训练学习数据的梯度</li>
<li>然后再加上学习率变成梯度下降法</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/11/03/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92(Logistic%E5%9B%9E%E5%BD%92)/" rel="next" title="逻辑回归(Logistic回归)">
                  <i class="fa fa-chevron-left"></i> 逻辑回归(Logistic回归)
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/11/13/%E8%81%9A%E7%B1%BB/" rel="prev" title="聚类">
                  聚类 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#决策树"><span class="nav-number">1.</span> <span class="nav-text">决策树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#类型"><span class="nav-number">1.1.</span> <span class="nav-text">类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优缺点"><span class="nav-number">1.2.</span> <span class="nav-text">优缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#香农熵-信息熵"><span class="nav-number">1.3.</span> <span class="nav-text">香农熵(信息熵)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#经验熵"><span class="nav-number">1.3.1.</span> <span class="nav-text">经验熵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件熵"><span class="nav-number">1.3.2.</span> <span class="nav-text">条件熵</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#信息增益"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">信息增益</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#信息增益比-信息增益率"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">信息增益比(信息增益率)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#信息增益与信息增益率区分"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">信息增益与信息增益率区分</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基尼不纯度"><span class="nav-number">1.4.</span> <span class="nav-text">基尼不纯度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#平方误差"><span class="nav-number">1.5.</span> <span class="nav-text">平方误差</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#算法框架"><span class="nav-number">1.6.</span> <span class="nav-text">算法框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#决策树主函数"><span class="nav-number">1.6.1.</span> <span class="nav-text">决策树主函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算最优特征子函数"><span class="nav-number">1.6.2.</span> <span class="nav-text">计算最优特征子函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分类器"><span class="nav-number">1.6.3.</span> <span class="nav-text">分类器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区分"><span class="nav-number">1.7.</span> <span class="nav-text">区分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C4-5对连续属性的处理"><span class="nav-number">1.8.</span> <span class="nav-text">C4.5对连续属性的处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#树回归"><span class="nav-number">1.9.</span> <span class="nav-text">树回归</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优缺点-1"><span class="nav-number">1.9.1.</span> <span class="nav-text">优缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#树回归的一般流程"><span class="nav-number">1.9.2.</span> <span class="nav-text">树回归的一般流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#树剪枝"><span class="nav-number">1.10.</span> <span class="nav-text">树剪枝</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#预剪枝"><span class="nav-number">1.10.1.</span> <span class="nav-text">预剪枝</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后剪枝"><span class="nav-number">1.10.2.</span> <span class="nav-text">后剪枝</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#错误率降低剪枝-REP"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">错误率降低剪枝(REP)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#悲观剪枝-PEP"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">悲观剪枝(PEP)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#思想"><span class="nav-number">1.10.2.2.1.</span> <span class="nav-text">思想</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代价复杂度剪枝-改版"><span class="nav-number">1.10.2.3.</span> <span class="nav-text">代价复杂度剪枝(改版)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#随机森林"><span class="nav-number">1.11.</span> <span class="nav-text">随机森林</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#随机的东西"><span class="nav-number">1.11.1.</span> <span class="nav-text">随机的东西</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可视化"><span class="nav-number">1.12.</span> <span class="nav-text">可视化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-熬测时候的裁员数据集"><span class="nav-number">1.13.</span> <span class="nav-text">Python(熬测时候的裁员数据集)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python糖尿病数据集"><span class="nav-number">1.14.</span> <span class="nav-text">Python糖尿病数据集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python鲍鱼年龄预测"><span class="nav-number">1.15.</span> <span class="nav-text">Python鲍鱼年龄预测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提升树"><span class="nav-number">1.16.</span> <span class="nav-text">提升树</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用于回归"><span class="nav-number">1.16.1.</span> <span class="nav-text">用于回归</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GDBT"><span class="nav-number">1.17.</span> <span class="nav-text">GDBT</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Facico"
    src="/images/psu.jpg">
  <p class="site-author-name" itemprop="name">Facico</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Facico" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;Facico" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>




       
      </div>
      <div id="music163player">
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=34014160&auto=1&height=66"></iframe>
      </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019.10.26 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Facico</span>
</div>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,0' opacity='0.4' zIndex='-1' count='1000' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  


















  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

  

</body>
</html>
